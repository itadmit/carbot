/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/chat/route";
exports.ids = ["app/api/chat/route"];
exports.modules = {

/***/ "(rsc)/./app/api/chat/route.ts":
/*!*******************************!*\
  !*** ./app/api/chat/route.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var _lib_chatbot__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/chatbot */ \"(rsc)/./lib/chatbot.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/types.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! zod */ \"(rsc)/./node_modules/zod/v3/ZodError.js\");\n\n\n\n\n\nconst chatSchema = zod__WEBPACK_IMPORTED_MODULE_4__.object({\n    message: zod__WEBPACK_IMPORTED_MODULE_4__.string().min(1, '注 专拽')\n});\nasync function POST(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: ' 专'\n            }, {\n                status: 401\n            });\n        }\n        const user = session.user;\n        // Only garages can use chat\n        if (user.role !== 'GARAGE') {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: '专拽 住  砖转砖 爪\\''\n            }, {\n                status: 403\n            });\n        }\n        const body = await request.json();\n        const { message } = chatSchema.parse(body);\n        const response = await (0,_lib_chatbot__WEBPACK_IMPORTED_MODULE_3__.processChatMessage)(user.id, message);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n    } catch (error) {\n        console.error('Chat error:', error);\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_5__.ZodError) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: '转  转拽',\n                details: error.errors\n            }, {\n                status: 400\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: '砖 爪\\''\n        }, {\n            status: 500\n        });\n    }\n}\nasync function GET(request) {\n    try {\n        const session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: ' 专'\n            }, {\n                status: 401\n            });\n        }\n        const user = session.user;\n        if (user.role !== 'GARAGE') {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: '专拽 住  砖转砖 爪\\''\n            }, {\n                status: 403\n            });\n        }\n        const response = await (0,_lib_chatbot__WEBPACK_IMPORTED_MODULE_3__.startChatSession)(user.id);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n    } catch (error) {\n        console.error('Chat start error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: '砖 转转 爪\\''\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NoYXQvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQXVEO0FBQ1g7QUFDSjtBQUM0QjtBQUM3QztBQUV2QixNQUFNTSxhQUFhRCx1Q0FBUSxDQUFDO0lBQzFCRyxTQUFTSCx1Q0FBUSxHQUFHSyxHQUFHLENBQUMsR0FBRztBQUM3QjtBQUVPLGVBQWVDLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1aLDJEQUFnQkEsQ0FBQ0Msa0RBQVdBO1FBRWxELElBQUksQ0FBQ1csU0FBUztZQUNaLE9BQU9iLHFEQUFZQSxDQUFDYyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBVyxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDaEU7UUFFQSxNQUFNQyxPQUFPSixRQUFRSSxJQUFJO1FBRXpCLDRCQUE0QjtRQUM1QixJQUFJQSxLQUFLQyxJQUFJLEtBQUssVUFBVTtZQUMxQixPQUFPbEIscURBQVlBLENBQUNjLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBaUMsR0FDMUM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU1HLE9BQU8sTUFBTVAsUUFBUUUsSUFBSTtRQUMvQixNQUFNLEVBQUVOLE9BQU8sRUFBRSxHQUFHRixXQUFXYyxLQUFLLENBQUNEO1FBRXJDLE1BQU1FLFdBQVcsTUFBTWxCLGdFQUFrQkEsQ0FBQ2MsS0FBS0ssRUFBRSxFQUFFZDtRQUVuRCxPQUFPUixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDTztJQUMzQixFQUFFLE9BQU9OLE9BQU87UUFDZFEsUUFBUVIsS0FBSyxDQUFDLGVBQWVBO1FBRTdCLElBQUlBLGlCQUFpQlYseUNBQVUsRUFBRTtZQUMvQixPQUFPTCxxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztnQkFBb0JVLFNBQVNWLE1BQU1XLE1BQU07WUFBQyxHQUNuRDtnQkFBRVYsUUFBUTtZQUFJO1FBRWxCO1FBRUEsT0FBT2hCLHFEQUFZQSxDQUFDYyxJQUFJLENBQ3RCO1lBQUVDLE9BQU87UUFBZSxHQUN4QjtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVPLGVBQWVXLElBQUlmLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNQyxVQUFVLE1BQU1aLDJEQUFnQkEsQ0FBQ0Msa0RBQVdBO1FBRWxELElBQUksQ0FBQ1csU0FBUztZQUNaLE9BQU9iLHFEQUFZQSxDQUFDYyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBVyxHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDaEU7UUFFQSxNQUFNQyxPQUFPSixRQUFRSSxJQUFJO1FBRXpCLElBQUlBLEtBQUtDLElBQUksS0FBSyxVQUFVO1lBQzFCLE9BQU9sQixxREFBWUEsQ0FBQ2MsSUFBSSxDQUN0QjtnQkFBRUMsT0FBTztZQUFpQyxHQUMxQztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTUssV0FBVyxNQUFNakIsOERBQWdCQSxDQUFDYSxLQUFLSyxFQUFFO1FBRS9DLE9BQU90QixxREFBWUEsQ0FBQ2MsSUFBSSxDQUFDTztJQUMzQixFQUFFLE9BQU9OLE9BQU87UUFDZFEsUUFBUVIsS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkMsT0FBT2YscURBQVlBLENBQUNjLElBQUksQ0FDdEI7WUFBRUMsT0FBTztRQUFxQixHQUM5QjtZQUFFQyxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL3RhZG1pdGludGVyYWN0aXZlL2NhcmJvdG5leHQvYXBwL2FwaS9jaGF0L3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IGdldFNlcnZlclNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgnXG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gJ0AvbGliL2F1dGgnXG5pbXBvcnQgeyBwcm9jZXNzQ2hhdE1lc3NhZ2UsIHN0YXJ0Q2hhdFNlc3Npb24gfSBmcm9tICdAL2xpYi9jaGF0Ym90J1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCdcblxuY29uc3QgY2hhdFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgbWVzc2FnZTogei5zdHJpbmcoKS5taW4oMSwgJ9eU15XXk9ei15Qg16jXmden15QnKSxcbn0pXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24oYXV0aE9wdGlvbnMpXG5cbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn15zXkCDXnteX15XXkdeoJyB9LCB7IHN0YXR1czogNDAxIH0pXG4gICAgfVxuXG4gICAgY29uc3QgdXNlciA9IHNlc3Npb24udXNlciBhcyBhbnlcblxuICAgIC8vIE9ubHkgZ2FyYWdlcyBjYW4gdXNlIGNoYXRcbiAgICBpZiAodXNlci5yb2xlICE9PSAnR0FSQUdFJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAn16jXpyDXnteV16HXm9eZ150g15nXm9eV15zXmdedINec15TXqdeq157XqSDXkdemXFwn15DXmCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyBtZXNzYWdlIH0gPSBjaGF0U2NoZW1hLnBhcnNlKGJvZHkpXG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHByb2Nlc3NDaGF0TWVzc2FnZSh1c2VyLmlkLCBtZXNzYWdlKVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NoYXQgZXJyb3I6JywgZXJyb3IpXG5cbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICfXoNeq15XXoNeZ150g15zXkCDXqten15nXoNeZ150nLCBkZXRhaWxzOiBlcnJvci5lcnJvcnMgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ9ep15LXmdeQ15Qg15HXplxcJ9eQ15gnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKGF1dGhPcHRpb25zKVxuXG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ9ec15Ag157Xl9eV15HXqCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIGNvbnN0IHVzZXIgPSBzZXNzaW9uLnVzZXIgYXMgYW55XG5cbiAgICBpZiAodXNlci5yb2xlICE9PSAnR0FSQUdFJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAn16jXpyDXnteV16HXm9eZ150g15nXm9eV15zXmdedINec15TXqdeq157XqSDXkdemXFwn15DXmCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydENoYXRTZXNzaW9uKHVzZXIuaWQpXG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24ocmVzcG9uc2UpXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignQ2hhdCBzdGFydCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAn16nXkteZ15DXlCDXkdeU16rXl9ec16og16ZcXCfXkNeYJyB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKVxuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJwcm9jZXNzQ2hhdE1lc3NhZ2UiLCJzdGFydENoYXRTZXNzaW9uIiwieiIsImNoYXRTY2hlbWEiLCJvYmplY3QiLCJtZXNzYWdlIiwic3RyaW5nIiwibWluIiwiUE9TVCIsInJlcXVlc3QiLCJzZXNzaW9uIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwidXNlciIsInJvbGUiLCJib2R5IiwicGFyc2UiLCJyZXNwb25zZSIsImlkIiwiY29uc29sZSIsIlpvZEVycm9yIiwiZGV0YWlscyIsImVycm9ycyIsIkdFVCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/chat/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   verifyPassword: () => (/* binding */ verifyPassword)\n/* harmony export */ });\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./lib/prisma.ts\");\n/**\n * Authentication utilities\n */ \n\n\n/**\n * Hash a password\n */ async function hashPassword(password) {\n    return (0,bcryptjs__WEBPACK_IMPORTED_MODULE_0__.hash)(password, 12);\n}\n/**\n * Verify a password\n */ async function verifyPassword(password, hashedPassword) {\n    return (0,bcryptjs__WEBPACK_IMPORTED_MODULE_0__.compare)(password, hashedPassword);\n}\n/**\n * NextAuth configuration\n */ const authOptions = {\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            name: 'Credentials',\n            credentials: {\n                email: {\n                    label: 'Email',\n                    type: 'email'\n                },\n                password: {\n                    label: 'Password',\n                    type: 'password'\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials?.password) {\n                    throw new Error('   住住');\n                }\n                const user = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n                    where: {\n                        email: credentials.email\n                    },\n                    include: {\n                        garage: true,\n                        supplier: true\n                    }\n                });\n                if (!user) {\n                    throw new Error('  住住 砖');\n                }\n                const isValid = await verifyPassword(credentials.password, user.password);\n                if (!isValid) {\n                    throw new Error('  住住 砖');\n                }\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    role: user.role,\n                    mobile: user.mobile,\n                    garageId: user.garage?.id,\n                    supplierId: user.supplier?.id\n                };\n            }\n        })\n    ],\n    callbacks: {\n        async jwt ({ token, user, trigger }) {\n            if (user) {\n                token.id = user.id;\n                token.role = user.role;\n                token.mobile = user.mobile;\n                token.garageId = user.garageId;\n                token.supplierId = user.supplierId;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (session.user && token) {\n                session.user.id = token.id;\n                session.user.role = token.role;\n                session.user.mobile = token.mobile;\n                session.user.garageId = token.garageId;\n                session.user.supplierId = token.supplierId;\n            }\n            return session;\n        }\n    },\n    pages: {\n        signIn: '/login',\n        error: '/login'\n    },\n    session: {\n        strategy: 'jwt'\n    },\n    secret: process.env.NEXTAUTH_SECRET\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZXJzL3RhZG1pdGludGVyYWN0aXZlL2NhcmJvdG5leHQvbGliL2F1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBdXRoZW50aWNhdGlvbiB1dGlsaXRpZXNcbiAqL1xuXG5pbXBvcnQgeyBoYXNoLCBjb21wYXJlIH0gZnJvbSAnYmNyeXB0anMnXG5pbXBvcnQgeyBOZXh0QXV0aE9wdGlvbnMsIFNlc3Npb24gfSBmcm9tICduZXh0LWF1dGgnXG5pbXBvcnQgeyBKV1QgfSBmcm9tICduZXh0LWF1dGgvand0J1xuaW1wb3J0IENyZWRlbnRpYWxzUHJvdmlkZXIgZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9jcmVkZW50aWFscydcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4vcHJpc21hJ1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ0BwcmlzbWEvY2xpZW50J1xuXG4vKipcbiAqIEhhc2ggYSBwYXNzd29yZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzaFBhc3N3b3JkKHBhc3N3b3JkOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gaGFzaChwYXNzd29yZCwgMTIpXG59XG5cbi8qKlxuICogVmVyaWZ5IGEgcGFzc3dvcmRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVBhc3N3b3JkKFxuICBwYXNzd29yZDogc3RyaW5nLFxuICBoYXNoZWRQYXNzd29yZDogc3RyaW5nXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGNvbXBhcmUocGFzc3dvcmQsIGhhc2hlZFBhc3N3b3JkKVxufVxuXG4vKipcbiAqIE5leHRBdXRoIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGNvbnN0IGF1dGhPcHRpb25zOiBOZXh0QXV0aE9wdGlvbnMgPSB7XG4gIHByb3ZpZGVyczogW1xuICAgIENyZWRlbnRpYWxzUHJvdmlkZXIoe1xuICAgICAgbmFtZTogJ0NyZWRlbnRpYWxzJyxcbiAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgIGVtYWlsOiB7IGxhYmVsOiAnRW1haWwnLCB0eXBlOiAnZW1haWwnIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IGxhYmVsOiAnUGFzc3dvcmQnLCB0eXBlOiAncGFzc3dvcmQnIH0sXG4gICAgICB9LFxuICAgICAgYXN5bmMgYXV0aG9yaXplKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHM/LmVtYWlsIHx8ICFjcmVkZW50aWFscz8ucGFzc3dvcmQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9eQ16DXkCDXlNeW158g15DXmdee15nXmdecINeV16HXmdeh157XlCcpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgd2hlcmU6IHsgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsIH0sXG4gICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgZ2FyYWdlOiB0cnVlLFxuICAgICAgICAgICAgc3VwcGxpZXI6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9eQ15nXnteZ15nXnCDXkNeVINeh15nXodee15Qg16nXkteV15nXmdedJylcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2ZXJpZnlQYXNzd29yZChcbiAgICAgICAgICBjcmVkZW50aWFscy5wYXNzd29yZCxcbiAgICAgICAgICB1c2VyLnBhc3N3b3JkXG4gICAgICAgIClcblxuICAgICAgICBpZiAoIWlzVmFsaWQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ9eQ15nXnteZ15nXnCDXkNeVINeh15nXodee15Qg16nXkteV15nXmdedJylcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgICBtb2JpbGU6IHVzZXIubW9iaWxlLFxuICAgICAgICAgIGdhcmFnZUlkOiB1c2VyLmdhcmFnZT8uaWQsXG4gICAgICAgICAgc3VwcGxpZXJJZDogdXNlci5zdXBwbGllcj8uaWQsXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSksXG4gIF0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyLCB0cmlnZ2VyIH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLmlkID0gdXNlci5pZFxuICAgICAgICB0b2tlbi5yb2xlID0gdXNlci5yb2xlIGFzIFJvbGVcbiAgICAgICAgdG9rZW4ubW9iaWxlID0gdXNlci5tb2JpbGUgYXMgc3RyaW5nXG4gICAgICAgIHRva2VuLmdhcmFnZUlkID0gKHVzZXIgYXMgYW55KS5nYXJhZ2VJZFxuICAgICAgICB0b2tlbi5zdXBwbGllcklkID0gKHVzZXIgYXMgYW55KS5zdXBwbGllcklkXG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW5cbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAoc2Vzc2lvbi51c2VyICYmIHRva2VuKSB7XG4gICAgICAgIChzZXNzaW9uLnVzZXIgYXMgYW55KS5pZCA9IHRva2VuLmlkIGFzIHN0cmluZ1xuICAgICAgICAoc2Vzc2lvbi51c2VyIGFzIGFueSkucm9sZSA9IHRva2VuLnJvbGUgYXMgUm9sZVxuICAgICAgICAoc2Vzc2lvbi51c2VyIGFzIGFueSkubW9iaWxlID0gdG9rZW4ubW9iaWxlIGFzIHN0cmluZ1xuICAgICAgICAoc2Vzc2lvbi51c2VyIGFzIGFueSkuZ2FyYWdlSWQgPSB0b2tlbi5nYXJhZ2VJZCBhcyBzdHJpbmcgfCB1bmRlZmluZWRcbiAgICAgICAgKHNlc3Npb24udXNlciBhcyBhbnkpLnN1cHBsaWVySWQgPSB0b2tlbi5zdXBwbGllcklkIGFzIHN0cmluZyB8IHVuZGVmaW5lZFxuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb25cbiAgICB9LFxuICB9LFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogJy9sb2dpbicsXG4gICAgZXJyb3I6ICcvbG9naW4nLFxuICB9LFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6ICdqd3QnLFxuICB9LFxuICBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCxcbn1cblxuLyoqXG4gKiBFeHRlbmRlZCBzZXNzaW9uIHR5cGUgd2l0aCBjdXN0b20gZmllbGRzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRXh0ZW5kZWRTZXNzaW9uIGV4dGVuZHMgU2Vzc2lvbiB7XG4gIHVzZXI6IHtcbiAgICBpZDogc3RyaW5nXG4gICAgZW1haWw6IHN0cmluZ1xuICAgIG5hbWU/OiBzdHJpbmcgfCBudWxsXG4gICAgcm9sZTogUm9sZVxuICAgIG1vYmlsZTogc3RyaW5nXG4gICAgZ2FyYWdlSWQ/OiBzdHJpbmdcbiAgICBzdXBwbGllcklkPzogc3RyaW5nXG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImhhc2giLCJjb21wYXJlIiwiQ3JlZGVudGlhbHNQcm92aWRlciIsInByaXNtYSIsImhhc2hQYXNzd29yZCIsInBhc3N3b3JkIiwidmVyaWZ5UGFzc3dvcmQiLCJoYXNoZWRQYXNzd29yZCIsImF1dGhPcHRpb25zIiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJhdXRob3JpemUiLCJFcnJvciIsInVzZXIiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpbmNsdWRlIiwiZ2FyYWdlIiwic3VwcGxpZXIiLCJpc1ZhbGlkIiwiaWQiLCJyb2xlIiwibW9iaWxlIiwiZ2FyYWdlSWQiLCJzdXBwbGllcklkIiwiY2FsbGJhY2tzIiwiand0IiwidG9rZW4iLCJ0cmlnZ2VyIiwic2Vzc2lvbiIsInBhZ2VzIiwic2lnbkluIiwiZXJyb3IiLCJzdHJhdGVneSIsInNlY3JldCIsInByb2Nlc3MiLCJlbnYiLCJORVhUQVVUSF9TRUNSRVQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/chatbot.ts":
/*!************************!*\
  !*** ./lib/chatbot.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   processChatMessage: () => (/* binding */ processChatMessage),\n/* harmony export */   startChatSession: () => (/* binding */ startChatSession)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _vehicle__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vehicle */ \"(rsc)/./lib/vehicle.ts\");\n/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./notifications */ \"(rsc)/./lib/notifications.ts\");\n/* harmony import */ var _matching__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./matching */ \"(rsc)/./lib/matching.ts\");\n/**\n * Chatbot Service\n * \n * Handles the conversational flow for creating requests via chat\n * \n * Flow:\n * 1. ASK_PLATE - Ask for vehicle plate number\n * 2. CONFIRM_VEHICLE - Confirm vehicle details\n * 3. ASK_PARTS - Ask for list of parts needed\n * 4. CONFIRM_REQUEST - Confirm and create request\n * 5. DONE - Complete\n */ \n\n\n\n/**\n * Process a user message and return bot response\n */ async function processChatMessage(userId, message) {\n    // Get or create chat session\n    let session = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatSession.findFirst({\n        where: {\n            userId,\n            state: {\n                not: 'DONE'\n            }\n        },\n        orderBy: {\n            createdAt: 'desc'\n        }\n    });\n    if (!session) {\n        // Create new session\n        session = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatSession.create({\n            data: {\n                userId,\n                state: 'ASK_PLATE',\n                context: {}\n            }\n        });\n    }\n    // Save user message\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatMessage.create({\n        data: {\n            sessionId: session.id,\n            from: 'USER',\n            text: message\n        }\n    });\n    const context = session.context || {};\n    // Process based on current state\n    let response;\n    switch(session.state){\n        case 'ASK_PLATE':\n            response = await handleAskPlate(message, context);\n            break;\n        case 'CONFIRM_VEHICLE':\n            response = await handleConfirmVehicle(message, context, userId);\n            break;\n        case 'ASK_PARTS':\n            response = await handleAskParts(message, context);\n            break;\n        case 'CONFIRM_REQUEST':\n            response = await handleConfirmRequest(message, context, userId, session.id);\n            break;\n        default:\n            response = {\n                text: ',  CarBot! \\n 住驻专 专?',\n                state: 'ASK_PLATE'\n            };\n    }\n    // Update session\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatSession.update({\n        where: {\n            id: session.id\n        },\n        data: {\n            state: response.state,\n            context: context\n        }\n    });\n    // Save bot response\n    await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.chatMessage.create({\n        data: {\n            sessionId: session.id,\n            from: 'BOT',\n            text: response.text\n        }\n    });\n    return response;\n}\n/**\n * Handle ASK_PLATE state\n */ async function handleAskPlate(message, context) {\n    const plateNumber = message.trim();\n    context.plateNumber = plateNumber;\n    try {\n        // Lookup vehicle\n        const vehicle = await (0,_vehicle__WEBPACK_IMPORTED_MODULE_1__.lookupVehicle)(plateNumber);\n        if (vehicle) {\n            context.vehicle = {\n                make: vehicle.make,\n                model: vehicle.model,\n                year: vehicle.year || undefined,\n                engine: vehicle.engine || undefined,\n                color: vehicle.color || undefined\n            };\n            const vehicleDesc = `${vehicle.make} ${vehicle.model}${vehicle.year ? ` ${vehicle.year}` : ''}${vehicle.engine ? `, 注 ${vehicle.engine}` : ''}`;\n            return {\n                text: `爪 专: ${vehicleDesc}\\n\\n  专 砖? (/)`,\n                state: 'CONFIRM_VEHICLE'\n            };\n        } else {\n            return {\n                text: ' 爪转 爪 转 专 .\\n 住 砖,  住驻专 专?',\n                state: 'ASK_PLATE'\n            };\n        }\n    } catch (error) {\n        console.error('Vehicle lookup error:', error);\n        return {\n            text: '转 砖 驻砖 专.\\n 住 砖,  住驻专 专?',\n            state: 'ASK_PLATE'\n        };\n    }\n}\n/**\n * Handle CONFIRM_VEHICLE state\n */ async function handleConfirmVehicle(message, context, userId) {\n    const answer = message.trim().toLowerCase();\n    if (answer === '' || answer === 'yes' || answer === '') {\n        return {\n            text: '住! \\n\\n 拽 转 爪专 注专 专 ?\\n 拽  拽 砖专 驻专转, 砖住转 转 \"住\".',\n            state: 'ASK_PARTS'\n        };\n    } else if (answer === '' || answer === 'no') {\n        // Reset context\n        context.plateNumber = undefined;\n        context.vehicle = undefined;\n        return {\n            text: '住专,  住 砖.\\n 住驻专 专?',\n            state: 'ASK_PLATE'\n        };\n    } else {\n        return {\n            text: ' 转...  注 \"\"  \"\".\\n\\n 专 砖?',\n            state: 'CONFIRM_VEHICLE'\n        };\n    }\n}\n/**\n * Handle ASK_PARTS state\n */ async function handleAskParts(message, context) {\n    const text = message.trim();\n    if (text === '住' || text === '住' || text === 'finish') {\n        if (!context.parts || context.parts.length === 0) {\n            return {\n                text: ' 住驻转 祝 拽 注.\\n 住祝 驻转 拽 ,  转 \"住\" 砖.',\n                state: 'ASK_PARTS'\n            };\n        }\n        const vehicleDesc = context.vehicle ? `${context.vehicle.make} ${context.vehicle.model}${context.vehicle.year ? ` ${context.vehicle.year}` : ''}` : '专';\n        const partsList = context.parts.map((p, i)=>`${i + 1}. ${p}`).join('\\n');\n        return {\n            text: `注!  住 拽砖:\\n\\n专: ${vehicleDesc}\\n拽:\\n${partsList}\\n\\n砖专 驻转 转 拽砖? (/)`,\n            state: 'CONFIRM_REQUEST'\n        };\n    }\n    // Add part to list\n    if (!context.parts) {\n        context.parts = [];\n    }\n    // Split by newlines in case user sent multiple lines\n    const newParts = text.split('\\n').map((p)=>p.trim()).filter((p)=>p.length > 0 && p !== '住');\n    context.parts.push(...newParts);\n    return {\n        text: `住祝: ${newParts.join(', ')}\\n\\n砖 住祝 拽,  转 \"住\" 砖.`,\n        state: 'ASK_PARTS'\n    };\n}\n/**\n * Handle CONFIRM_REQUEST state\n */ async function handleConfirmRequest(message, context, userId, sessionId) {\n    const answer = message.trim().toLowerCase();\n    if (answer === '' || answer === 'yes' || answer === '砖专') {\n        try {\n            // Get user's garage\n            const user = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n                where: {\n                    id: userId\n                },\n                include: {\n                    garage: true\n                }\n            });\n            if (!user || !user.garage) {\n                return {\n                    text: '砖:  爪 住 砖转砖 .',\n                    state: 'DONE'\n                };\n            }\n            // Get or create vehicle in DB\n            let vehicle = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicle.findUnique({\n                where: {\n                    plateNumber: context.plateNumber\n                }\n            });\n            if (!vehicle && context.vehicle) {\n                vehicle = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicle.create({\n                    data: {\n                        plateNumber: context.plateNumber,\n                        make: context.vehicle.make,\n                        model: context.vehicle.model,\n                        year: context.vehicle.year,\n                        engine: context.vehicle.engine,\n                        color: context.vehicle.color\n                    }\n                });\n            }\n            // Create request\n            const request = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.request.create({\n                data: {\n                    garageId: user.garage.id,\n                    vehicleId: vehicle?.id,\n                    status: 'OPEN',\n                    items: {\n                        create: context.parts.map((partName)=>({\n                                name: partName\n                            }))\n                    }\n                },\n                include: {\n                    items: true\n                }\n            });\n            // Send notification to garage\n            await (0,_notifications__WEBPACK_IMPORTED_MODULE_2__.notifyGarageRequestCreated)(request.id, user.garage.phone || user.mobile, userId);\n            // Find and notify matching suppliers\n            await (0,_matching__WEBPACK_IMPORTED_MODULE_3__.notifyMatchingSuppliers)(request.id);\n            return {\n                text: `拽砖 爪专 爪! \\n\\n住驻专 拽砖: #${request.id.slice(-6)}\\n\\n砖 转专 住驻拽 转.\\n转拽 注 砖注 爪注转 专.`,\n                state: 'DONE'\n            };\n        } catch (error) {\n            console.error('Error creating request:', error);\n            return {\n                text: '转 砖 爪专转 拽砖.\\n 住 砖 专 转专.',\n                state: 'DONE'\n            };\n        }\n    } else if (answer === '' || answer === 'no' || answer === '') {\n        // Reset\n        context.parts = undefined;\n        context.vehicle = undefined;\n        context.plateNumber = undefined;\n        return {\n            text: '拽砖 .\\n\\n专爪 转 砖?  住驻专 专?',\n            state: 'ASK_PLATE'\n        };\n    } else {\n        return {\n            text: ' 转...  注 \"\" 砖专  \"\" .',\n            state: 'CONFIRM_REQUEST'\n        };\n    }\n}\n/**\n * Start a new chat session\n */ async function startChatSession(userId) {\n    return {\n        text: ',  CarBot! \\n\\n  注专  爪 拽 祝 专.\\n 住驻专 专?',\n        state: 'ASK_PLATE'\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNRDs0QkFDUjtvQkFDRjtnQkFDRjtnQkFDQVAsU0FBUztvQkFDUE0sT0FBTztnQkFDVDtZQUNGO1lBRUEsOEJBQThCO1lBQzlCLE1BQU01RCwwRUFBMEJBLENBQzlCd0QsUUFBUXRDLEVBQUUsRUFDVmtDLEtBQUtHLE1BQU0sQ0FBQ1EsS0FBSyxJQUFJWCxLQUFLWSxNQUFNLEVBQ2hDN0Q7WUFHRixxQ0FBcUM7WUFDckMsTUFBTUYsa0VBQXVCQSxDQUFDdUQsUUFBUXRDLEVBQUU7WUFFeEMsT0FBTztnQkFDTEUsTUFBTSxDQUFDLHNDQUFzQyxFQUFFb0MsUUFBUXRDLEVBQUUsQ0FBQytDLEtBQUssQ0FDN0QsQ0FBQyxHQUNELCtEQUErRCxDQUFDO2dCQUNsRXhELE9BQU87WUFDVDtRQUNGLEVBQUUsT0FBTzRCLE9BQU87WUFDZEMsUUFBUUQsS0FBSyxDQUFDLDJCQUEyQkE7WUFDekMsT0FBTztnQkFDTGpCLE1BQU07Z0JBQ05YLE9BQU87WUFDVDtRQUNGO0lBQ0YsT0FBTyxJQUFJOEIsV0FBVyxRQUFRQSxXQUFXLFFBQVFBLFdBQVcsU0FBUztRQUNuRSxRQUFRO1FBQ1J4QixRQUFRMEIsS0FBSyxHQUFHUjtRQUNoQmxCLFFBQVFjLE9BQU8sR0FBR0k7UUFDbEJsQixRQUFRWSxXQUFXLEdBQUdNO1FBRXRCLE9BQU87WUFDTGIsTUFBTTtZQUNOWCxPQUFPO1FBQ1Q7SUFDRixPQUFPO1FBQ0wsT0FBTztZQUNMVyxNQUFNO1lBQ05YLE9BQU87UUFDVDtJQUNGO0FBQ0Y7QUFFQTs7Q0FFQyxHQUNNLGVBQWV5RCxpQkFBaUIvRCxNQUFjO0lBQ25ELE9BQU87UUFDTGlCLE1BQU07UUFDTlgsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy90YWRtaXRpbnRlcmFjdGl2ZS9jYXJib3RuZXh0L2xpYi9jaGF0Ym90LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2hhdGJvdCBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgdGhlIGNvbnZlcnNhdGlvbmFsIGZsb3cgZm9yIGNyZWF0aW5nIHJlcXVlc3RzIHZpYSBjaGF0XG4gKiBcbiAqIEZsb3c6XG4gKiAxLiBBU0tfUExBVEUgLSBBc2sgZm9yIHZlaGljbGUgcGxhdGUgbnVtYmVyXG4gKiAyLiBDT05GSVJNX1ZFSElDTEUgLSBDb25maXJtIHZlaGljbGUgZGV0YWlsc1xuICogMy4gQVNLX1BBUlRTIC0gQXNrIGZvciBsaXN0IG9mIHBhcnRzIG5lZWRlZFxuICogNC4gQ09ORklSTV9SRVFVRVNUIC0gQ29uZmlybSBhbmQgY3JlYXRlIHJlcXVlc3RcbiAqIDUuIERPTkUgLSBDb21wbGV0ZVxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4vcHJpc21hJ1xuaW1wb3J0IHsgQ2hhdFN0YXRlIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5pbXBvcnQgeyBsb29rdXBWZWhpY2xlIH0gZnJvbSAnLi92ZWhpY2xlJ1xuaW1wb3J0IHsgbm90aWZ5R2FyYWdlUmVxdWVzdENyZWF0ZWQgfSBmcm9tICcuL25vdGlmaWNhdGlvbnMnXG5pbXBvcnQgeyBub3RpZnlNYXRjaGluZ1N1cHBsaWVycyB9IGZyb20gJy4vbWF0Y2hpbmcnXG5cbmludGVyZmFjZSBDaGF0Q29udGV4dCB7XG4gIHBsYXRlTnVtYmVyPzogc3RyaW5nXG4gIHZlaGljbGU/OiB7XG4gICAgbWFrZTogc3RyaW5nXG4gICAgbW9kZWw6IHN0cmluZ1xuICAgIHllYXI/OiBudW1iZXJcbiAgICBlbmdpbmU/OiBzdHJpbmdcbiAgICBjb2xvcj86IHN0cmluZ1xuICB9XG4gIHBhcnRzPzogc3RyaW5nW11cbn1cblxuaW50ZXJmYWNlIENoYXRSZXNwb25zZSB7XG4gIHRleHQ6IHN0cmluZ1xuICBzdGF0ZTogQ2hhdFN0YXRlXG59XG5cbi8qKlxuICogUHJvY2VzcyBhIHVzZXIgbWVzc2FnZSBhbmQgcmV0dXJuIGJvdCByZXNwb25zZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0NoYXRNZXNzYWdlKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgbWVzc2FnZTogc3RyaW5nXG4pOiBQcm9taXNlPENoYXRSZXNwb25zZT4ge1xuICAvLyBHZXQgb3IgY3JlYXRlIGNoYXQgc2Vzc2lvblxuICBsZXQgc2Vzc2lvbiA9IGF3YWl0IHByaXNtYS5jaGF0U2Vzc2lvbi5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQsXG4gICAgICBzdGF0ZTogeyBub3Q6ICdET05FJyB9LFxuICAgIH0sXG4gICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxuICB9KVxuXG4gIGlmICghc2Vzc2lvbikge1xuICAgIC8vIENyZWF0ZSBuZXcgc2Vzc2lvblxuICAgIHNlc3Npb24gPSBhd2FpdCBwcmlzbWEuY2hhdFNlc3Npb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBzdGF0ZTogJ0FTS19QTEFURScsXG4gICAgICAgIGNvbnRleHQ6IHt9LFxuICAgICAgfSxcbiAgICB9KVxuICB9XG5cbiAgLy8gU2F2ZSB1c2VyIG1lc3NhZ2VcbiAgYXdhaXQgcHJpc21hLmNoYXRNZXNzYWdlLmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgc2Vzc2lvbklkOiBzZXNzaW9uLmlkLFxuICAgICAgZnJvbTogJ1VTRVInLFxuICAgICAgdGV4dDogbWVzc2FnZSxcbiAgICB9LFxuICB9KVxuXG4gIGNvbnN0IGNvbnRleHQgPSAoc2Vzc2lvbi5jb250ZXh0IGFzIENoYXRDb250ZXh0KSB8fCB7fVxuXG4gIC8vIFByb2Nlc3MgYmFzZWQgb24gY3VycmVudCBzdGF0ZVxuICBsZXQgcmVzcG9uc2U6IENoYXRSZXNwb25zZVxuXG4gIHN3aXRjaCAoc2Vzc2lvbi5zdGF0ZSkge1xuICAgIGNhc2UgJ0FTS19QTEFURSc6XG4gICAgICByZXNwb25zZSA9IGF3YWl0IGhhbmRsZUFza1BsYXRlKG1lc3NhZ2UsIGNvbnRleHQpXG4gICAgICBicmVha1xuXG4gICAgY2FzZSAnQ09ORklSTV9WRUhJQ0xFJzpcbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlQ29uZmlybVZlaGljbGUobWVzc2FnZSwgY29udGV4dCwgdXNlcklkKVxuICAgICAgYnJlYWtcblxuICAgIGNhc2UgJ0FTS19QQVJUUyc6XG4gICAgICByZXNwb25zZSA9IGF3YWl0IGhhbmRsZUFza1BhcnRzKG1lc3NhZ2UsIGNvbnRleHQpXG4gICAgICBicmVha1xuXG4gICAgY2FzZSAnQ09ORklSTV9SRVFVRVNUJzpcbiAgICAgIHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlQ29uZmlybVJlcXVlc3QobWVzc2FnZSwgY29udGV4dCwgdXNlcklkLCBzZXNzaW9uLmlkKVxuICAgICAgYnJlYWtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXNwb25zZSA9IHtcbiAgICAgICAgdGV4dDogJ9eU15nXmSwg15DXoNeZIENhckJvdCEg8J+al1xcbtee15Qg157Xodek16gg15TXqNeb15E/JyxcbiAgICAgICAgc3RhdGU6ICdBU0tfUExBVEUnLFxuICAgICAgfVxuICB9XG5cbiAgLy8gVXBkYXRlIHNlc3Npb25cbiAgYXdhaXQgcHJpc21hLmNoYXRTZXNzaW9uLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHNlc3Npb24uaWQgfSxcbiAgICBkYXRhOiB7XG4gICAgICBzdGF0ZTogcmVzcG9uc2Uuc3RhdGUsXG4gICAgICBjb250ZXh0OiBjb250ZXh0IGFzIGFueSxcbiAgICB9LFxuICB9KVxuXG4gIC8vIFNhdmUgYm90IHJlc3BvbnNlXG4gIGF3YWl0IHByaXNtYS5jaGF0TWVzc2FnZS5jcmVhdGUoe1xuICAgIGRhdGE6IHtcbiAgICAgIHNlc3Npb25JZDogc2Vzc2lvbi5pZCxcbiAgICAgIGZyb206ICdCT1QnLFxuICAgICAgdGV4dDogcmVzcG9uc2UudGV4dCxcbiAgICB9LFxuICB9KVxuXG4gIHJldHVybiByZXNwb25zZVxufVxuXG4vKipcbiAqIEhhbmRsZSBBU0tfUExBVEUgc3RhdGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQXNrUGxhdGUoXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgY29udGV4dDogQ2hhdENvbnRleHRcbik6IFByb21pc2U8Q2hhdFJlc3BvbnNlPiB7XG4gIGNvbnN0IHBsYXRlTnVtYmVyID0gbWVzc2FnZS50cmltKClcbiAgY29udGV4dC5wbGF0ZU51bWJlciA9IHBsYXRlTnVtYmVyXG5cbiAgdHJ5IHtcbiAgICAvLyBMb29rdXAgdmVoaWNsZVxuICAgIGNvbnN0IHZlaGljbGUgPSBhd2FpdCBsb29rdXBWZWhpY2xlKHBsYXRlTnVtYmVyKVxuXG4gICAgaWYgKHZlaGljbGUpIHtcbiAgICAgIGNvbnRleHQudmVoaWNsZSA9IHtcbiAgICAgICAgbWFrZTogdmVoaWNsZS5tYWtlLFxuICAgICAgICBtb2RlbDogdmVoaWNsZS5tb2RlbCxcbiAgICAgICAgeWVhcjogdmVoaWNsZS55ZWFyIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgZW5naW5lOiB2ZWhpY2xlLmVuZ2luZSB8fCB1bmRlZmluZWQsXG4gICAgICAgIGNvbG9yOiB2ZWhpY2xlLmNvbG9yIHx8IHVuZGVmaW5lZCxcbiAgICAgIH1cblxuICAgICAgY29uc3QgdmVoaWNsZURlc2MgPSBgJHt2ZWhpY2xlLm1ha2V9ICR7dmVoaWNsZS5tb2RlbH0ke1xuICAgICAgICB2ZWhpY2xlLnllYXIgPyBgICR7dmVoaWNsZS55ZWFyfWAgOiAnJ1xuICAgICAgfSR7dmVoaWNsZS5lbmdpbmUgPyBgLCDXnteg15XXoiAke3ZlaGljbGUuZW5naW5lfWAgOiAnJ31gXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6IGDXoNee16bXkCDXqNeb15E6ICR7dmVoaWNsZURlc2N9XFxuXFxu15DXliDXlteUINeU16jXm9eRINep15zXmj8gKNeb158v15zXkClgLFxuICAgICAgICBzdGF0ZTogJ0NPTkZJUk1fVkVISUNMRScsXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6ICfXnNeQINeU16bXnNeX16rXmSDXnNee16bXldeQINeQ16og15TXqNeb15Eg15TXlteULlxcbteR15XXkNeVINeg16DXodeUINep15XXkSwg157XlCDXnteh16TXqCDXlNeo15vXkT8nLFxuICAgICAgICBzdGF0ZTogJ0FTS19QTEFURScsXG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZlaGljbGUgbG9va3VwIGVycm9yOicsIGVycm9yKVxuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAn15TXmdeZ16rXlCDXqdeS15nXkNeUINeR15fXmdek15XXqSDXlNeo15vXkS5cXG7XkdeV15DXlSDXoNeg16HXlCDXqdeV15EsINee15Qg157Xodek16gg15TXqNeb15E/JyxcbiAgICAgIHN0YXRlOiAnQVNLX1BMQVRFJyxcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBIYW5kbGUgQ09ORklSTV9WRUhJQ0xFIHN0YXRlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNvbmZpcm1WZWhpY2xlKFxuICBtZXNzYWdlOiBzdHJpbmcsXG4gIGNvbnRleHQ6IENoYXRDb250ZXh0LFxuICB1c2VySWQ6IHN0cmluZ1xuKTogUHJvbWlzZTxDaGF0UmVzcG9uc2U+IHtcbiAgY29uc3QgYW5zd2VyID0gbWVzc2FnZS50cmltKCkudG9Mb3dlckNhc2UoKVxuXG4gIGlmIChhbnN3ZXIgPT09ICfXm9efJyB8fCBhbnN3ZXIgPT09ICd5ZXMnIHx8IGFuc3dlciA9PT0gJ9eg15vXldefJykge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAn16HXkdeR15QhIPCfkY1cXG5cXG7XkNeZ15bXlCDXl9ec16fXmdedINeQ16rXlCDXpteo15nXmiDXoteR15XXqCDXlNeo15vXkSDXlNeW15Q/XFxu15DXoNeQINeU16fXnNeTINeb15wg15fXnNenINeR16nXldeo15Qg16DXpNeo15PXqiwg15XXm9ep16HXmdeZ157XqiDXm9eq15XXkSBcIteh15nXmdedXCIuJyxcbiAgICAgIHN0YXRlOiAnQVNLX1BBUlRTJyxcbiAgICB9XG4gIH0gZWxzZSBpZiAoYW5zd2VyID09PSAn15zXkCcgfHwgYW5zd2VyID09PSAnbm8nKSB7XG4gICAgLy8gUmVzZXQgY29udGV4dFxuICAgIGNvbnRleHQucGxhdGVOdW1iZXIgPSB1bmRlZmluZWRcbiAgICBjb250ZXh0LnZlaGljbGUgPSB1bmRlZmluZWRcblxuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAn15HXodeT16gsINeR15XXkNeVINeg16DXodeUINep15XXkS5cXG7XnteUINee16HXpNeoINeU16jXm9eRPycsXG4gICAgICBzdGF0ZTogJ0FTS19QTEFURScsXG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAn15zXkCDXlNeR16DXqteZLi4uINeQ16DXkCDXoteg15QgXCLXm9efXCIg15DXlSBcItec15BcIi5cXG5cXG7XlteUINeU16jXm9eRINep15zXmj8nLFxuICAgICAgc3RhdGU6ICdDT05GSVJNX1ZFSElDTEUnLFxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIEhhbmRsZSBBU0tfUEFSVFMgc3RhdGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlQXNrUGFydHMoXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgY29udGV4dDogQ2hhdENvbnRleHRcbik6IFByb21pc2U8Q2hhdFJlc3BvbnNlPiB7XG4gIGNvbnN0IHRleHQgPSBtZXNzYWdlLnRyaW0oKVxuXG4gIGlmICh0ZXh0ID09PSAn16HXmdeZ150nIHx8IHRleHQgPT09ICfXodeZ15XXnScgfHwgdGV4dCA9PT0gJ2ZpbmlzaCcpIHtcbiAgICBpZiAoIWNvbnRleHQucGFydHMgfHwgY29udGV4dC5wYXJ0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6ICfXnNeQINeU15XXodek16og15DXoyDXl9ec16cg16LXk9eZ15nXny5cXG7XkNeg15Ag15TXldeh16Mg15zXpNeX15XXqiDXl9ec16cg15DXl9eTLCDXkNeVINeb16rXldeRIFwi16HXmdeZ151cIiDXm9ep157Xldeb158uJyxcbiAgICAgICAgc3RhdGU6ICdBU0tfUEFSVFMnLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHZlaGljbGVEZXNjID0gY29udGV4dC52ZWhpY2xlXG4gICAgICA/IGAke2NvbnRleHQudmVoaWNsZS5tYWtlfSAke2NvbnRleHQudmVoaWNsZS5tb2RlbH0ke1xuICAgICAgICAgIGNvbnRleHQudmVoaWNsZS55ZWFyID8gYCAke2NvbnRleHQudmVoaWNsZS55ZWFyfWAgOiAnJ1xuICAgICAgICB9YFxuICAgICAgOiAn15TXqNeb15EnXG5cbiAgICBjb25zdCBwYXJ0c0xpc3QgPSBjb250ZXh0LnBhcnRzLm1hcCgocCwgaSkgPT4gYCR7aSArIDF9LiAke3B9YCkuam9pbignXFxuJylcblxuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiBg157XoteV15zXlCEg15TXoNeUINeh15nXm9eV150g15TXkden16nXlDpcXG5cXG7XqNeb15E6ICR7dmVoaWNsZURlc2N9XFxu15fXnNen15nXnTpcXG4ke3BhcnRzTGlzdH1cXG5cXG7XnNeQ16nXqCDXldec16TXqteV15cg15DXqiDXlNeR16fXqdeUPyAo15vXny/XnNeQKWAsXG4gICAgICBzdGF0ZTogJ0NPTkZJUk1fUkVRVUVTVCcsXG4gICAgfVxuICB9XG5cbiAgLy8gQWRkIHBhcnQgdG8gbGlzdFxuICBpZiAoIWNvbnRleHQucGFydHMpIHtcbiAgICBjb250ZXh0LnBhcnRzID0gW11cbiAgfVxuXG4gIC8vIFNwbGl0IGJ5IG5ld2xpbmVzIGluIGNhc2UgdXNlciBzZW50IG11bHRpcGxlIGxpbmVzXG4gIGNvbnN0IG5ld1BhcnRzID0gdGV4dFxuICAgIC5zcGxpdCgnXFxuJylcbiAgICAubWFwKChwKSA9PiBwLnRyaW0oKSlcbiAgICAuZmlsdGVyKChwKSA9PiBwLmxlbmd0aCA+IDAgJiYgcCAhPT0gJ9eh15nXmdedJylcblxuICBjb250ZXh0LnBhcnRzLnB1c2goLi4ubmV3UGFydHMpXG5cbiAgcmV0dXJuIHtcbiAgICB0ZXh0OiBg16DXldeh16M6ICR7bmV3UGFydHMuam9pbignLCAnKX1cXG5cXG7XlNee16nXmiDXnNeU15XXodeZ16Mg15fXnNen15nXnSwg15DXlSDXm9eq15XXkSBcIteh15nXmdedXCIg15vXqdee15XXm9efLmAsXG4gICAgc3RhdGU6ICdBU0tfUEFSVFMnLFxuICB9XG59XG5cbi8qKlxuICogSGFuZGxlIENPTkZJUk1fUkVRVUVTVCBzdGF0ZVxuICovXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDb25maXJtUmVxdWVzdChcbiAgbWVzc2FnZTogc3RyaW5nLFxuICBjb250ZXh0OiBDaGF0Q29udGV4dCxcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHNlc3Npb25JZDogc3RyaW5nXG4pOiBQcm9taXNlPENoYXRSZXNwb25zZT4ge1xuICBjb25zdCBhbnN3ZXIgPSBtZXNzYWdlLnRyaW0oKS50b0xvd2VyQ2FzZSgpXG5cbiAgaWYgKGFuc3dlciA9PT0gJ9eb158nIHx8IGFuc3dlciA9PT0gJ3llcycgfHwgYW5zd2VyID09PSAn15DXqdeoJykge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdXNlcidzIGdhcmFnZVxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHsgZ2FyYWdlOiB0cnVlIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXVzZXIgfHwgIXVzZXIuZ2FyYWdlKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdGV4dDogJ9ep15LXmdeQ15Q6INec15Ag16DXntem15Ag157Xldeh15og15zXntep16rXntepINeW15QuJyxcbiAgICAgICAgICBzdGF0ZTogJ0RPTkUnLFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBvciBjcmVhdGUgdmVoaWNsZSBpbiBEQlxuICAgICAgbGV0IHZlaGljbGUgPSBhd2FpdCBwcmlzbWEudmVoaWNsZS5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgcGxhdGVOdW1iZXI6IGNvbnRleHQucGxhdGVOdW1iZXIhIH0sXG4gICAgICB9KVxuXG4gICAgICBpZiAoIXZlaGljbGUgJiYgY29udGV4dC52ZWhpY2xlKSB7XG4gICAgICAgIHZlaGljbGUgPSBhd2FpdCBwcmlzbWEudmVoaWNsZS5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHBsYXRlTnVtYmVyOiBjb250ZXh0LnBsYXRlTnVtYmVyISxcbiAgICAgICAgICAgIG1ha2U6IGNvbnRleHQudmVoaWNsZS5tYWtlLFxuICAgICAgICAgICAgbW9kZWw6IGNvbnRleHQudmVoaWNsZS5tb2RlbCxcbiAgICAgICAgICAgIHllYXI6IGNvbnRleHQudmVoaWNsZS55ZWFyLFxuICAgICAgICAgICAgZW5naW5lOiBjb250ZXh0LnZlaGljbGUuZW5naW5lLFxuICAgICAgICAgICAgY29sb3I6IGNvbnRleHQudmVoaWNsZS5jb2xvcixcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgcmVxdWVzdFxuICAgICAgY29uc3QgcmVxdWVzdCA9IGF3YWl0IHByaXNtYS5yZXF1ZXN0LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBnYXJhZ2VJZDogdXNlci5nYXJhZ2UuaWQsXG4gICAgICAgICAgdmVoaWNsZUlkOiB2ZWhpY2xlPy5pZCxcbiAgICAgICAgICBzdGF0dXM6ICdPUEVOJyxcbiAgICAgICAgICBpdGVtczoge1xuICAgICAgICAgICAgY3JlYXRlOiBjb250ZXh0LnBhcnRzIS5tYXAoKHBhcnROYW1lKSA9PiAoe1xuICAgICAgICAgICAgICBuYW1lOiBwYXJ0TmFtZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgaXRlbXM6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9KVxuXG4gICAgICAvLyBTZW5kIG5vdGlmaWNhdGlvbiB0byBnYXJhZ2VcbiAgICAgIGF3YWl0IG5vdGlmeUdhcmFnZVJlcXVlc3RDcmVhdGVkKFxuICAgICAgICByZXF1ZXN0LmlkLFxuICAgICAgICB1c2VyLmdhcmFnZS5waG9uZSB8fCB1c2VyLm1vYmlsZSxcbiAgICAgICAgdXNlcklkXG4gICAgICApXG5cbiAgICAgIC8vIEZpbmQgYW5kIG5vdGlmeSBtYXRjaGluZyBzdXBwbGllcnNcbiAgICAgIGF3YWl0IG5vdGlmeU1hdGNoaW5nU3VwcGxpZXJzKHJlcXVlc3QuaWQpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRleHQ6IGDXlNeR16fXqdeUINeg15XXpteo15Qg15HXlNem15zXl9eUISDwn46JXFxuXFxu157Xodek16gg15HXp9ep15Q6ICMke3JlcXVlc3QuaWQuc2xpY2UoXG4gICAgICAgICAgLTZcbiAgICAgICAgKX1cXG5cXG7XoNep15zXl9eUINeU16rXqNeQ15Qg15zXodek16fXmdedINee16rXkNeZ157XmdedLlxcbteq16fXkdecINeU15XXk9ei15Qg15vXqdeZ15LXmdei15Ug15TXptei15XXqiDXnteX15nXqC5gLFxuICAgICAgICBzdGF0ZTogJ0RPTkUnLFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyByZXF1ZXN0OicsIGVycm9yKVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGV4dDogJ9eU15nXmdeq15Qg16nXkteZ15DXlCDXkdeZ16bXmdeo16og15TXkden16nXlC5cXG7XkNeg15Ag16DXodeUINep15XXkSDXnteQ15XXl9eoINeZ15XXqteoLicsXG4gICAgICAgIHN0YXRlOiAnRE9ORScsXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKGFuc3dlciA9PT0gJ9ec15AnIHx8IGFuc3dlciA9PT0gJ25vJyB8fCBhbnN3ZXIgPT09ICfXkdeZ15jXldecJykge1xuICAgIC8vIFJlc2V0XG4gICAgY29udGV4dC5wYXJ0cyA9IHVuZGVmaW5lZFxuICAgIGNvbnRleHQudmVoaWNsZSA9IHVuZGVmaW5lZFxuICAgIGNvbnRleHQucGxhdGVOdW1iZXIgPSB1bmRlZmluZWRcblxuICAgIHJldHVybiB7XG4gICAgICB0ZXh0OiAn15TXkden16nXlCDXkdeV15jXnNeULlxcblxcbteo15XXpteUINec15TXqteX15nXnCDXnteX15PXqT8g157XlCDXnteh16TXqCDXlNeo15vXkT8nLFxuICAgICAgc3RhdGU6ICdBU0tfUExBVEUnLFxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgdGV4dDogJ9ec15Ag15TXkdeg16rXmS4uLiDXkNeg15Ag16LXoNeUIFwi15vXn1wiINec15DXmdep15XXqCDXkNeVIFwi15zXkFwiINec15HXmdeY15XXnC4nLFxuICAgICAgc3RhdGU6ICdDT05GSVJNX1JFUVVFU1QnLFxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIFN0YXJ0IGEgbmV3IGNoYXQgc2Vzc2lvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3RhcnRDaGF0U2Vzc2lvbih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8Q2hhdFJlc3BvbnNlPiB7XG4gIHJldHVybiB7XG4gICAgdGV4dDogJ9eU15nXmSwg15DXoNeZIENhckJvdCEg8J+al1xcblxcbteQ16DXmSDXm9eQ158g15zXoteW15XXqCDXnNeaINec157XpteV15Ag15fXnNen15kg15fXmdec15XXoyDXnNeo15vXkS5cXG7XnteUINee16HXpNeoINeU16jXm9eRPycsXG4gICAgc3RhdGU6ICdBU0tfUExBVEUnLFxuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJsb29rdXBWZWhpY2xlIiwibm90aWZ5R2FyYWdlUmVxdWVzdENyZWF0ZWQiLCJub3RpZnlNYXRjaGluZ1N1cHBsaWVycyIsInByb2Nlc3NDaGF0TWVzc2FnZSIsInVzZXJJZCIsIm1lc3NhZ2UiLCJzZXNzaW9uIiwiY2hhdFNlc3Npb24iLCJmaW5kRmlyc3QiLCJ3aGVyZSIsInN0YXRlIiwibm90Iiwib3JkZXJCeSIsImNyZWF0ZWRBdCIsImNyZWF0ZSIsImRhdGEiLCJjb250ZXh0IiwiY2hhdE1lc3NhZ2UiLCJzZXNzaW9uSWQiLCJpZCIsImZyb20iLCJ0ZXh0IiwicmVzcG9uc2UiLCJoYW5kbGVBc2tQbGF0ZSIsImhhbmRsZUNvbmZpcm1WZWhpY2xlIiwiaGFuZGxlQXNrUGFydHMiLCJoYW5kbGVDb25maXJtUmVxdWVzdCIsInVwZGF0ZSIsInBsYXRlTnVtYmVyIiwidHJpbSIsInZlaGljbGUiLCJtYWtlIiwibW9kZWwiLCJ5ZWFyIiwidW5kZWZpbmVkIiwiZW5naW5lIiwiY29sb3IiLCJ2ZWhpY2xlRGVzYyIsImVycm9yIiwiY29uc29sZSIsImFuc3dlciIsInRvTG93ZXJDYXNlIiwicGFydHMiLCJsZW5ndGgiLCJwYXJ0c0xpc3QiLCJtYXAiLCJwIiwiaSIsImpvaW4iLCJuZXdQYXJ0cyIsInNwbGl0IiwiZmlsdGVyIiwicHVzaCIsInVzZXIiLCJmaW5kVW5pcXVlIiwiaW5jbHVkZSIsImdhcmFnZSIsInJlcXVlc3QiLCJnYXJhZ2VJZCIsInZlaGljbGVJZCIsInN0YXR1cyIsIml0ZW1zIiwicGFydE5hbWUiLCJuYW1lIiwicGhvbmUiLCJtb2JpbGUiLCJzbGljZSIsInN0YXJ0Q2hhdFNlc3Npb24iXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/chatbot.ts\n");

/***/ }),

/***/ "(rsc)/./lib/matching.ts":
/*!*************************!*\
  !*** ./lib/matching.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   findMatchingSuppliers: () => (/* binding */ findMatchingSuppliers),\n/* harmony export */   notifyMatchingSuppliers: () => (/* binding */ notifyMatchingSuppliers)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _notifications__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./notifications */ \"(rsc)/./lib/notifications.ts\");\n/**\n * Matching Service\n * \n * Matches new requests with relevant suppliers based on:\n * - Vehicle make/model\n * - Geographic region\n * - Supplier preferences\n */ \n\n/**\n * Find suppliers that match a request's criteria\n */ async function findMatchingSuppliers(requestId) {\n    // Get request with vehicle and garage info\n    const request = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.request.findUnique({\n        where: {\n            id: requestId\n        },\n        include: {\n            vehicle: true,\n            garage: {\n                include: {\n                    user: true\n                }\n            }\n        }\n    });\n    if (!request || !request.vehicle) {\n        return [];\n    }\n    const { vehicle, garage } = request;\n    // Get all active suppliers with their preferences\n    const allSuppliers = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.supplier.findMany({\n        where: {\n            active: true\n        },\n        include: {\n            user: true,\n            preferences: true\n        }\n    });\n    // Filter suppliers that match the request\n    const matchingSuppliers = allSuppliers.filter((supplier)=>{\n        // If supplier has no preferences, don't match\n        if (supplier.preferences.length === 0) {\n            return false;\n        }\n        // Check if any preference matches\n        return supplier.preferences.some((pref)=>{\n            // Check if preference is for \"ALL\" vehicles ( 专)\n            if (pref.vehicleMake === 'ALL') {\n                // If preference has a specific region, check region match\n                if (pref.region && pref.region.trim() !== '') {\n                    // Both have region - must match\n                    if (garage.region) {\n                        return pref.region === garage.region;\n                    }\n                    // Preference has region but garage doesn't - no match\n                    return false;\n                }\n                // No region specified in preference - match all regions\n                return true;\n            }\n            // Check vehicle make match (case insensitive, partial match)\n            const prefMake = pref.vehicleMake.toLowerCase().trim();\n            const vehicleMake = vehicle.make.toLowerCase().trim();\n            // Try exact match first\n            let makeMatches = prefMake === vehicleMake;\n            // If no exact match, try partial match (e.g., \"Tesla\" matches \"住 住\")\n            if (!makeMatches) {\n                // Check if vehicle make contains preference make or vice versa\n                makeMatches = vehicleMake.includes(prefMake) || prefMake.includes(vehicleMake);\n            }\n            if (!makeMatches) {\n                return false;\n            }\n            // If preference has a specific model, check model match\n            if (pref.vehicleModel && pref.vehicleModel.trim() !== '') {\n                const prefModel = pref.vehicleModel.toLowerCase().trim();\n                const vehicleModel = vehicle.model.toLowerCase().trim();\n                // Try exact match first\n                let modelMatches = prefModel === vehicleModel;\n                // If no exact match, try partial match\n                if (!modelMatches) {\n                    modelMatches = vehicleModel.includes(prefModel) || prefModel.includes(vehicleModel);\n                }\n                if (!modelMatches) {\n                    return false;\n                }\n            }\n            // Check region match if preference has a specific region\n            if (pref.region && pref.region.trim() !== '') {\n                // Preference has region - must match garage region\n                if (garage.region) {\n                    return pref.region === garage.region;\n                }\n                // Preference has region but garage doesn't - no match\n                return false;\n            }\n            // All checks passed - match!\n            return true;\n        });\n    });\n    return matchingSuppliers.map((supplier)=>({\n            supplierId: supplier.id,\n            supplierName: supplier.businessName,\n            supplierMobile: supplier.phone || supplier.user.mobile,\n            userId: supplier.userId\n        }));\n}\n/**\n * Notify all matching suppliers about a new request\n */ async function notifyMatchingSuppliers(requestId) {\n    try {\n        // Get request details\n        const request = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.request.findUnique({\n            where: {\n                id: requestId\n            },\n            include: {\n                vehicle: true,\n                items: true\n            }\n        });\n        if (!request || !request.vehicle) {\n            throw new Error('Request or vehicle not found');\n        }\n        // Find matching suppliers\n        const matchingSuppliers = await findMatchingSuppliers(requestId);\n        if (matchingSuppliers.length === 0) {\n            console.log(`No matching suppliers found for request ${requestId}`);\n            return;\n        }\n        // Prepare vehicle and parts info\n        const vehicleInfo = {\n            make: request.vehicle.make,\n            model: request.vehicle.model,\n            year: request.vehicle.year || undefined\n        };\n        const parts = request.items.map((item)=>item.name);\n        // Send notifications to all matching suppliers\n        const notifications = matchingSuppliers.map((supplier)=>(0,_notifications__WEBPACK_IMPORTED_MODULE_1__.notifySupplierNewRequest)(requestId, supplier.supplierMobile, supplier.userId, vehicleInfo, parts));\n        await Promise.allSettled(notifications);\n        console.log(`Notified ${matchingSuppliers.length} suppliers about request ${requestId}`);\n    } catch (error) {\n        console.error('Error notifying matching suppliers:', error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQUNpQixPQUFTQSxLQUFLQyxJQUFJO1FBRW5ELCtDQUErQztRQUMvQyxNQUFNQyxnQkFBZ0JwQyxrQkFBa0JpQixHQUFHLENBQUMsQ0FBQ3JCLFdBQzNDWix3RUFBd0JBLENBQ3RCRSxXQUNBVSxTQUFTeUIsY0FBYyxFQUN2QnpCLFNBQVM0QixNQUFNLEVBQ2ZNLGFBQ0FHO1FBSUosTUFBTUksUUFBUUMsVUFBVSxDQUFDRjtRQUV6QlIsUUFBUUMsR0FBRyxDQUNULENBQUMsU0FBUyxFQUFFN0Isa0JBQWtCRSxNQUFNLENBQUMseUJBQXlCLEVBQUVoQixXQUFXO0lBRS9FLEVBQUUsT0FBT3FELE9BQU87UUFDZFgsUUFBUVcsS0FBSyxDQUFDLHVDQUF1Q0E7UUFDckQsTUFBTUE7SUFDUjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvdGFkbWl0aW50ZXJhY3RpdmUvY2FyYm90bmV4dC9saWIvbWF0Y2hpbmcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNYXRjaGluZyBTZXJ2aWNlXG4gKiBcbiAqIE1hdGNoZXMgbmV3IHJlcXVlc3RzIHdpdGggcmVsZXZhbnQgc3VwcGxpZXJzIGJhc2VkIG9uOlxuICogLSBWZWhpY2xlIG1ha2UvbW9kZWxcbiAqIC0gR2VvZ3JhcGhpYyByZWdpb25cbiAqIC0gU3VwcGxpZXIgcHJlZmVyZW5jZXNcbiAqL1xuXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICcuL3ByaXNtYSdcbmltcG9ydCB7IG5vdGlmeVN1cHBsaWVyTmV3UmVxdWVzdCB9IGZyb20gJy4vbm90aWZpY2F0aW9ucydcblxuaW50ZXJmYWNlIE1hdGNoaW5nU3VwcGxpZXJzUmVzdWx0IHtcbiAgc3VwcGxpZXJJZDogc3RyaW5nXG4gIHN1cHBsaWVyTmFtZTogc3RyaW5nXG4gIHN1cHBsaWVyTW9iaWxlOiBzdHJpbmdcbiAgdXNlcklkOiBzdHJpbmdcbn1cblxuLyoqXG4gKiBGaW5kIHN1cHBsaWVycyB0aGF0IG1hdGNoIGEgcmVxdWVzdCdzIGNyaXRlcmlhXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBmaW5kTWF0Y2hpbmdTdXBwbGllcnMoXG4gIHJlcXVlc3RJZDogc3RyaW5nXG4pOiBQcm9taXNlPE1hdGNoaW5nU3VwcGxpZXJzUmVzdWx0W10+IHtcbiAgLy8gR2V0IHJlcXVlc3Qgd2l0aCB2ZWhpY2xlIGFuZCBnYXJhZ2UgaW5mb1xuICBjb25zdCByZXF1ZXN0ID0gYXdhaXQgcHJpc21hLnJlcXVlc3QuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IHJlcXVlc3RJZCB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHZlaGljbGU6IHRydWUsXG4gICAgICBnYXJhZ2U6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pXG5cbiAgaWYgKCFyZXF1ZXN0IHx8ICFyZXF1ZXN0LnZlaGljbGUpIHtcbiAgICByZXR1cm4gW11cbiAgfVxuXG4gIGNvbnN0IHsgdmVoaWNsZSwgZ2FyYWdlIH0gPSByZXF1ZXN0XG5cbiAgLy8gR2V0IGFsbCBhY3RpdmUgc3VwcGxpZXJzIHdpdGggdGhlaXIgcHJlZmVyZW5jZXNcbiAgY29uc3QgYWxsU3VwcGxpZXJzID0gYXdhaXQgcHJpc21hLnN1cHBsaWVyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgIHByZWZlcmVuY2VzOiB0cnVlLFxuICAgIH0sXG4gIH0pXG5cbiAgLy8gRmlsdGVyIHN1cHBsaWVycyB0aGF0IG1hdGNoIHRoZSByZXF1ZXN0XG4gIGNvbnN0IG1hdGNoaW5nU3VwcGxpZXJzID0gYWxsU3VwcGxpZXJzLmZpbHRlcigoc3VwcGxpZXIpID0+IHtcbiAgICAvLyBJZiBzdXBwbGllciBoYXMgbm8gcHJlZmVyZW5jZXMsIGRvbid0IG1hdGNoXG4gICAgaWYgKHN1cHBsaWVyLnByZWZlcmVuY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYW55IHByZWZlcmVuY2UgbWF0Y2hlc1xuICAgIHJldHVybiBzdXBwbGllci5wcmVmZXJlbmNlcy5zb21lKChwcmVmKSA9PiB7XG4gICAgICAvLyBDaGVjayBpZiBwcmVmZXJlbmNlIGlzIGZvciBcIkFMTFwiIHZlaGljbGVzICjXm9ecINeU16jXm9eR15nXnSlcbiAgICAgIGlmIChwcmVmLnZlaGljbGVNYWtlID09PSAnQUxMJykge1xuICAgICAgICAvLyBJZiBwcmVmZXJlbmNlIGhhcyBhIHNwZWNpZmljIHJlZ2lvbiwgY2hlY2sgcmVnaW9uIG1hdGNoXG4gICAgICAgIGlmIChwcmVmLnJlZ2lvbiAmJiBwcmVmLnJlZ2lvbi50cmltKCkgIT09ICcnKSB7XG4gICAgICAgICAgLy8gQm90aCBoYXZlIHJlZ2lvbiAtIG11c3QgbWF0Y2hcbiAgICAgICAgICBpZiAoZ2FyYWdlLnJlZ2lvbikge1xuICAgICAgICAgICAgcmV0dXJuIHByZWYucmVnaW9uID09PSBnYXJhZ2UucmVnaW9uXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFByZWZlcmVuY2UgaGFzIHJlZ2lvbiBidXQgZ2FyYWdlIGRvZXNuJ3QgLSBubyBtYXRjaFxuICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIC8vIE5vIHJlZ2lvbiBzcGVjaWZpZWQgaW4gcHJlZmVyZW5jZSAtIG1hdGNoIGFsbCByZWdpb25zXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHZlaGljbGUgbWFrZSBtYXRjaCAoY2FzZSBpbnNlbnNpdGl2ZSwgcGFydGlhbCBtYXRjaClcbiAgICAgIGNvbnN0IHByZWZNYWtlID0gcHJlZi52ZWhpY2xlTWFrZS50b0xvd2VyQ2FzZSgpLnRyaW0oKVxuICAgICAgY29uc3QgdmVoaWNsZU1ha2UgPSB2ZWhpY2xlLm1ha2UudG9Mb3dlckNhc2UoKS50cmltKClcbiAgICAgIFxuICAgICAgLy8gVHJ5IGV4YWN0IG1hdGNoIGZpcnN0XG4gICAgICBsZXQgbWFrZU1hdGNoZXMgPSBwcmVmTWFrZSA9PT0gdmVoaWNsZU1ha2VcbiAgICAgIFxuICAgICAgLy8gSWYgbm8gZXhhY3QgbWF0Y2gsIHRyeSBwYXJ0aWFsIG1hdGNoIChlLmcuLCBcIlRlc2xhXCIgbWF0Y2hlcyBcIteY16HXnNeUINeh15nXn1wiKVxuICAgICAgaWYgKCFtYWtlTWF0Y2hlcykge1xuICAgICAgICAvLyBDaGVjayBpZiB2ZWhpY2xlIG1ha2UgY29udGFpbnMgcHJlZmVyZW5jZSBtYWtlIG9yIHZpY2UgdmVyc2FcbiAgICAgICAgbWFrZU1hdGNoZXMgPSBcbiAgICAgICAgICB2ZWhpY2xlTWFrZS5pbmNsdWRlcyhwcmVmTWFrZSkgfHwgXG4gICAgICAgICAgcHJlZk1ha2UuaW5jbHVkZXModmVoaWNsZU1ha2UpXG4gICAgICB9XG5cbiAgICAgIGlmICghbWFrZU1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIC8vIElmIHByZWZlcmVuY2UgaGFzIGEgc3BlY2lmaWMgbW9kZWwsIGNoZWNrIG1vZGVsIG1hdGNoXG4gICAgICBpZiAocHJlZi52ZWhpY2xlTW9kZWwgJiYgcHJlZi52ZWhpY2xlTW9kZWwudHJpbSgpICE9PSAnJykge1xuICAgICAgICBjb25zdCBwcmVmTW9kZWwgPSBwcmVmLnZlaGljbGVNb2RlbC50b0xvd2VyQ2FzZSgpLnRyaW0oKVxuICAgICAgICBjb25zdCB2ZWhpY2xlTW9kZWwgPSB2ZWhpY2xlLm1vZGVsLnRvTG93ZXJDYXNlKCkudHJpbSgpXG4gICAgICAgIFxuICAgICAgICAvLyBUcnkgZXhhY3QgbWF0Y2ggZmlyc3RcbiAgICAgICAgbGV0IG1vZGVsTWF0Y2hlcyA9IHByZWZNb2RlbCA9PT0gdmVoaWNsZU1vZGVsXG4gICAgICAgIFxuICAgICAgICAvLyBJZiBubyBleGFjdCBtYXRjaCwgdHJ5IHBhcnRpYWwgbWF0Y2hcbiAgICAgICAgaWYgKCFtb2RlbE1hdGNoZXMpIHtcbiAgICAgICAgICBtb2RlbE1hdGNoZXMgPSBcbiAgICAgICAgICAgIHZlaGljbGVNb2RlbC5pbmNsdWRlcyhwcmVmTW9kZWwpIHx8IFxuICAgICAgICAgICAgcHJlZk1vZGVsLmluY2x1ZGVzKHZlaGljbGVNb2RlbClcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKCFtb2RlbE1hdGNoZXMpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayByZWdpb24gbWF0Y2ggaWYgcHJlZmVyZW5jZSBoYXMgYSBzcGVjaWZpYyByZWdpb25cbiAgICAgIGlmIChwcmVmLnJlZ2lvbiAmJiBwcmVmLnJlZ2lvbi50cmltKCkgIT09ICcnKSB7XG4gICAgICAgIC8vIFByZWZlcmVuY2UgaGFzIHJlZ2lvbiAtIG11c3QgbWF0Y2ggZ2FyYWdlIHJlZ2lvblxuICAgICAgICBpZiAoZ2FyYWdlLnJlZ2lvbikge1xuICAgICAgICAgIHJldHVybiBwcmVmLnJlZ2lvbiA9PT0gZ2FyYWdlLnJlZ2lvblxuICAgICAgICB9XG4gICAgICAgIC8vIFByZWZlcmVuY2UgaGFzIHJlZ2lvbiBidXQgZ2FyYWdlIGRvZXNuJ3QgLSBubyBtYXRjaFxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgIH1cblxuICAgICAgLy8gQWxsIGNoZWNrcyBwYXNzZWQgLSBtYXRjaCFcbiAgICAgIHJldHVybiB0cnVlXG4gICAgfSlcbiAgfSlcblxuICByZXR1cm4gbWF0Y2hpbmdTdXBwbGllcnMubWFwKChzdXBwbGllcikgPT4gKHtcbiAgICBzdXBwbGllcklkOiBzdXBwbGllci5pZCxcbiAgICBzdXBwbGllck5hbWU6IHN1cHBsaWVyLmJ1c2luZXNzTmFtZSxcbiAgICBzdXBwbGllck1vYmlsZTogc3VwcGxpZXIucGhvbmUgfHwgc3VwcGxpZXIudXNlci5tb2JpbGUsXG4gICAgdXNlcklkOiBzdXBwbGllci51c2VySWQsXG4gIH0pKVxufVxuXG4vKipcbiAqIE5vdGlmeSBhbGwgbWF0Y2hpbmcgc3VwcGxpZXJzIGFib3V0IGEgbmV3IHJlcXVlc3RcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG5vdGlmeU1hdGNoaW5nU3VwcGxpZXJzKHJlcXVlc3RJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHJlcXVlc3QgZGV0YWlsc1xuICAgIGNvbnN0IHJlcXVlc3QgPSBhd2FpdCBwcmlzbWEucmVxdWVzdC5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiByZXF1ZXN0SWQgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgdmVoaWNsZTogdHJ1ZSxcbiAgICAgICAgaXRlbXM6IHRydWUsXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICBpZiAoIXJlcXVlc3QgfHwgIXJlcXVlc3QudmVoaWNsZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXF1ZXN0IG9yIHZlaGljbGUgbm90IGZvdW5kJylcbiAgICB9XG5cbiAgICAvLyBGaW5kIG1hdGNoaW5nIHN1cHBsaWVyc1xuICAgIGNvbnN0IG1hdGNoaW5nU3VwcGxpZXJzID0gYXdhaXQgZmluZE1hdGNoaW5nU3VwcGxpZXJzKHJlcXVlc3RJZClcblxuICAgIGlmIChtYXRjaGluZ1N1cHBsaWVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKGBObyBtYXRjaGluZyBzdXBwbGllcnMgZm91bmQgZm9yIHJlcXVlc3QgJHtyZXF1ZXN0SWR9YClcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIC8vIFByZXBhcmUgdmVoaWNsZSBhbmQgcGFydHMgaW5mb1xuICAgIGNvbnN0IHZlaGljbGVJbmZvID0ge1xuICAgICAgbWFrZTogcmVxdWVzdC52ZWhpY2xlLm1ha2UsXG4gICAgICBtb2RlbDogcmVxdWVzdC52ZWhpY2xlLm1vZGVsLFxuICAgICAgeWVhcjogcmVxdWVzdC52ZWhpY2xlLnllYXIgfHwgdW5kZWZpbmVkLFxuICAgIH1cblxuICAgIGNvbnN0IHBhcnRzID0gcmVxdWVzdC5pdGVtcy5tYXAoKGl0ZW0pID0+IGl0ZW0ubmFtZSlcblxuICAgIC8vIFNlbmQgbm90aWZpY2F0aW9ucyB0byBhbGwgbWF0Y2hpbmcgc3VwcGxpZXJzXG4gICAgY29uc3Qgbm90aWZpY2F0aW9ucyA9IG1hdGNoaW5nU3VwcGxpZXJzLm1hcCgoc3VwcGxpZXIpID0+XG4gICAgICBub3RpZnlTdXBwbGllck5ld1JlcXVlc3QoXG4gICAgICAgIHJlcXVlc3RJZCxcbiAgICAgICAgc3VwcGxpZXIuc3VwcGxpZXJNb2JpbGUsXG4gICAgICAgIHN1cHBsaWVyLnVzZXJJZCxcbiAgICAgICAgdmVoaWNsZUluZm8sXG4gICAgICAgIHBhcnRzXG4gICAgICApXG4gICAgKVxuXG4gICAgYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKG5vdGlmaWNhdGlvbnMpXG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIGBOb3RpZmllZCAke21hdGNoaW5nU3VwcGxpZXJzLmxlbmd0aH0gc3VwcGxpZXJzIGFib3V0IHJlcXVlc3QgJHtyZXF1ZXN0SWR9YFxuICAgIClcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBub3RpZnlpbmcgbWF0Y2hpbmcgc3VwcGxpZXJzOicsIGVycm9yKVxuICAgIHRocm93IGVycm9yXG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbInByaXNtYSIsIm5vdGlmeVN1cHBsaWVyTmV3UmVxdWVzdCIsImZpbmRNYXRjaGluZ1N1cHBsaWVycyIsInJlcXVlc3RJZCIsInJlcXVlc3QiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJpZCIsImluY2x1ZGUiLCJ2ZWhpY2xlIiwiZ2FyYWdlIiwidXNlciIsImFsbFN1cHBsaWVycyIsInN1cHBsaWVyIiwiZmluZE1hbnkiLCJhY3RpdmUiLCJwcmVmZXJlbmNlcyIsIm1hdGNoaW5nU3VwcGxpZXJzIiwiZmlsdGVyIiwibGVuZ3RoIiwic29tZSIsInByZWYiLCJ2ZWhpY2xlTWFrZSIsInJlZ2lvbiIsInRyaW0iLCJwcmVmTWFrZSIsInRvTG93ZXJDYXNlIiwibWFrZSIsIm1ha2VNYXRjaGVzIiwiaW5jbHVkZXMiLCJ2ZWhpY2xlTW9kZWwiLCJwcmVmTW9kZWwiLCJtb2RlbCIsIm1vZGVsTWF0Y2hlcyIsIm1hcCIsInN1cHBsaWVySWQiLCJzdXBwbGllck5hbWUiLCJidXNpbmVzc05hbWUiLCJzdXBwbGllck1vYmlsZSIsInBob25lIiwibW9iaWxlIiwidXNlcklkIiwibm90aWZ5TWF0Y2hpbmdTdXBwbGllcnMiLCJpdGVtcyIsIkVycm9yIiwiY29uc29sZSIsImxvZyIsInZlaGljbGVJbmZvIiwieWVhciIsInVuZGVmaW5lZCIsInBhcnRzIiwiaXRlbSIsIm5hbWUiLCJub3RpZmljYXRpb25zIiwiUHJvbWlzZSIsImFsbFNldHRsZWQiLCJlcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/matching.ts\n");

/***/ }),

/***/ "(rsc)/./lib/notifications.ts":
/*!******************************!*\
  !*** ./lib/notifications.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   notifyGarageNewOffer: () => (/* binding */ notifyGarageNewOffer),\n/* harmony export */   notifyGarageRequestCreated: () => (/* binding */ notifyGarageRequestCreated),\n/* harmony export */   notifySupplierNewRequest: () => (/* binding */ notifySupplierNewRequest),\n/* harmony export */   sendNotification: () => (/* binding */ sendNotification)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _whatsapp__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./whatsapp */ \"(rsc)/./lib/whatsapp.ts\");\n/**\n * Notification Service\n * \n * Handles sending notifications and logging them in the database\n */ \n\n/**\n * Send a notification via WhatsApp and log it in DB\n */ async function sendNotification({ userId, mobile, type, text, data }) {\n    try {\n        const formattedMobile = (0,_whatsapp__WEBPACK_IMPORTED_MODULE_1__.formatPhoneNumber)(mobile);\n        const result = await (0,_whatsapp__WEBPACK_IMPORTED_MODULE_1__.sendWhatsApp)(formattedMobile, text);\n        // Log notification in database\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.notification.create({\n            data: {\n                userId,\n                type,\n                data: data ? JSON.parse(JSON.stringify(data)) : null,\n                sentVia: 'WHATSAPP',\n                success: result.success,\n                error: result.success ? null : result.message\n            }\n        });\n        return result;\n    } catch (error) {\n        // Log failed notification\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.notification.create({\n            data: {\n                userId,\n                type,\n                data: data ? JSON.parse(JSON.stringify(data)) : null,\n                sentVia: 'WHATSAPP',\n                success: false,\n                error: error instanceof Error ? error.message : 'Unknown error'\n            }\n        });\n        throw error;\n    }\n}\n/**\n * Notify garage about new request\n */ async function notifyGarageRequestCreated(requestId, garageMobile, garageUserId) {\n    const text = `CarBot \\n\\n拽砖 驻转 爪! (#${requestId.slice(-6)})\\n注 专注 砖住驻拽 .`;\n    await sendNotification({\n        userId: garageUserId,\n        mobile: garageMobile,\n        type: 'NEW_REQUEST',\n        text,\n        data: {\n            requestId\n        }\n    });\n}\n/**\n * Notify supplier about new matching request\n */ async function notifySupplierNewRequest(requestId, supplierMobile, supplierUserId, vehicleInfo, parts) {\n    const vehicleDesc = `${vehicleInfo.make} ${vehicleInfo.model}${vehicleInfo.year ? ` ${vehicleInfo.year}` : ''}`;\n    const partsDesc = parts.join(', ');\n    const text = `CarBot \n拽砖 砖 拽 祝!\n\n专: ${vehicleDesc}\n拽: ${partsDesc}\n\n抓  爪注转 专:\n${process.env.NEXTAUTH_URL}/supplier/requests/${requestId}`;\n    await sendNotification({\n        userId: supplierUserId,\n        mobile: supplierMobile,\n        type: 'NEW_REQUEST',\n        text,\n        data: {\n            requestId,\n            vehicleInfo,\n            parts\n        }\n    });\n}\n/**\n * Notify garage about new offer\n */ async function notifyGarageNewOffer(offerId, requestId, garageMobile, garageUserId, supplierName, supplierPhone, vehicleInfo, parts, totalPrice) {\n    const vehicleDesc = `${vehicleInfo.make} ${vehicleInfo.model}${vehicleInfo.year ? ` ${vehicleInfo.year}` : ''}`;\n    const partsDesc = parts.join(', ');\n    const text = `CarBot \n拽转 爪注 砖!\n\n住驻拽: ${supplierName}\n专: ${vehicleDesc}\n拽: ${partsDesc}\n专 : ${totalPrice.toLocaleString('he-IL')} \n\n驻 住驻拽: ${supplierPhone}\n\n爪驻 爪注转:\n${process.env.NEXTAUTH_URL}/garage/requests/${requestId}`;\n    await sendNotification({\n        userId: garageUserId,\n        mobile: garageMobile,\n        type: 'NEW_OFFER',\n        text,\n        data: {\n            offerId,\n            requestId,\n            supplierName,\n            totalPrice\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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N0IsTUFBTTdCLE9BQU8sQ0FBQzs7O0tBR1gsRUFBRW1DLGFBQWE7S0FDZixFQUFFWCxZQUFZO09BQ1osRUFBRUksVUFBVTtXQUNSLEVBQUVTLFdBQVdDLGNBQWMsQ0FBQyxTQUFTOztXQUVyQyxFQUFFRixjQUFjOzs7QUFHM0IsRUFBRU4sUUFBUUMsR0FBRyxDQUFDQyxZQUFZLENBQUMsaUJBQWlCLEVBQUVqQixXQUFXO0lBRXZELE1BQU1uQixpQkFBaUI7UUFDckJDLFFBQVFvQjtRQUNSbkIsUUFBUWtCO1FBQ1JqQixNQUFNO1FBQ05DO1FBQ0FDLE1BQU07WUFBRWlDO1lBQVNuQjtZQUFXb0I7WUFBY0U7UUFBVztJQUN2RDtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvdGFkbWl0aW50ZXJhY3RpdmUvY2FyYm90bmV4dC9saWIvbm90aWZpY2F0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE5vdGlmaWNhdGlvbiBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgc2VuZGluZyBub3RpZmljYXRpb25zIGFuZCBsb2dnaW5nIHRoZW0gaW4gdGhlIGRhdGFiYXNlXG4gKi9cblxuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi9wcmlzbWEnXG5pbXBvcnQgeyBzZW5kV2hhdHNBcHAsIGZvcm1hdFBob25lTnVtYmVyIH0gZnJvbSAnLi93aGF0c2FwcCdcbmltcG9ydCB7IE5vdGlmaWNhdGlvblR5cGUgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuaW50ZXJmYWNlIE5vdGlmaWNhdGlvbkRhdGEge1xuICB1c2VySWQ6IHN0cmluZ1xuICBtb2JpbGU6IHN0cmluZ1xuICB0eXBlOiBOb3RpZmljYXRpb25UeXBlXG4gIHRleHQ6IHN0cmluZ1xuICBkYXRhPzogYW55XG59XG5cbi8qKlxuICogU2VuZCBhIG5vdGlmaWNhdGlvbiB2aWEgV2hhdHNBcHAgYW5kIGxvZyBpdCBpbiBEQlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE5vdGlmaWNhdGlvbih7XG4gIHVzZXJJZCxcbiAgbW9iaWxlLFxuICB0eXBlLFxuICB0ZXh0LFxuICBkYXRhLFxufTogTm90aWZpY2F0aW9uRGF0YSkge1xuICB0cnkge1xuICAgIGNvbnN0IGZvcm1hdHRlZE1vYmlsZSA9IGZvcm1hdFBob25lTnVtYmVyKG1vYmlsZSlcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZW5kV2hhdHNBcHAoZm9ybWF0dGVkTW9iaWxlLCB0ZXh0KVxuXG4gICAgLy8gTG9nIG5vdGlmaWNhdGlvbiBpbiBkYXRhYmFzZVxuICAgIGF3YWl0IHByaXNtYS5ub3RpZmljYXRpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB0eXBlLFxuICAgICAgICBkYXRhOiBkYXRhID8gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkYXRhKSkgOiBudWxsLFxuICAgICAgICBzZW50VmlhOiAnV0hBVFNBUFAnLFxuICAgICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgICAgZXJyb3I6IHJlc3VsdC5zdWNjZXNzID8gbnVsbCA6IHJlc3VsdC5tZXNzYWdlLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgcmV0dXJuIHJlc3VsdFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vIExvZyBmYWlsZWQgbm90aWZpY2F0aW9uXG4gICAgYXdhaXQgcHJpc21hLm5vdGlmaWNhdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIHR5cGUsXG4gICAgICAgIGRhdGE6IGRhdGEgPyBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpKSA6IG51bGwsXG4gICAgICAgIHNlbnRWaWE6ICdXSEFUU0FQUCcsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9LFxuICAgIH0pXG5cbiAgICB0aHJvdyBlcnJvclxuICB9XG59XG5cbi8qKlxuICogTm90aWZ5IGdhcmFnZSBhYm91dCBuZXcgcmVxdWVzdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5R2FyYWdlUmVxdWVzdENyZWF0ZWQoXG4gIHJlcXVlc3RJZDogc3RyaW5nLFxuICBnYXJhZ2VNb2JpbGU6IHN0cmluZyxcbiAgZ2FyYWdlVXNlcklkOiBzdHJpbmdcbikge1xuICBjb25zdCB0ZXh0ID0gYENhckJvdCDwn5qXXFxuXFxu15TXkden16nXlCDXoNek16rXl9eUINeR15TXptec15fXlCEgKCMke3JlcXVlc3RJZC5zbGljZSgtNil9KVxcbteg16LXk9eb158g15HXqNeS16Ig16nXodek16fXmdedINee15LXmdeR15nXnS5gXG5cbiAgYXdhaXQgc2VuZE5vdGlmaWNhdGlvbih7XG4gICAgdXNlcklkOiBnYXJhZ2VVc2VySWQsXG4gICAgbW9iaWxlOiBnYXJhZ2VNb2JpbGUsXG4gICAgdHlwZTogJ05FV19SRVFVRVNUJyxcbiAgICB0ZXh0LFxuICAgIGRhdGE6IHsgcmVxdWVzdElkIH0sXG4gIH0pXG59XG5cbi8qKlxuICogTm90aWZ5IHN1cHBsaWVyIGFib3V0IG5ldyBtYXRjaGluZyByZXF1ZXN0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBub3RpZnlTdXBwbGllck5ld1JlcXVlc3QoXG4gIHJlcXVlc3RJZDogc3RyaW5nLFxuICBzdXBwbGllck1vYmlsZTogc3RyaW5nLFxuICBzdXBwbGllclVzZXJJZDogc3RyaW5nLFxuICB2ZWhpY2xlSW5mbzogeyBtYWtlOiBzdHJpbmc7IG1vZGVsOiBzdHJpbmc7IHllYXI/OiBudW1iZXIgfSxcbiAgcGFydHM6IHN0cmluZ1tdXG4pIHtcbiAgY29uc3QgdmVoaWNsZURlc2MgPSBgJHt2ZWhpY2xlSW5mby5tYWtlfSAke3ZlaGljbGVJbmZvLm1vZGVsfSR7XG4gICAgdmVoaWNsZUluZm8ueWVhciA/IGAgJHt2ZWhpY2xlSW5mby55ZWFyfWAgOiAnJ1xuICB9YFxuICBjb25zdCBwYXJ0c0Rlc2MgPSBwYXJ0cy5qb2luKCcsICcpXG5cbiAgY29uc3QgdGV4dCA9IGBDYXJCb3Qg8J+al1xu15HXp9ep15Qg15fXk9ep15Qg15zXl9ec16fXmSDXl9eZ15zXldejIVxuXG7XqNeb15E6ICR7dmVoaWNsZURlc2N9XG7Xl9ec16fXmdedOiAke3BhcnRzRGVzY31cblxu15zXl9elINeb15DXnyDXnNeU16bXoteqINee15fXmdeoOlxuJHtwcm9jZXNzLmVudi5ORVhUQVVUSF9VUkx9L3N1cHBsaWVyL3JlcXVlc3RzLyR7cmVxdWVzdElkfWBcblxuICBhd2FpdCBzZW5kTm90aWZpY2F0aW9uKHtcbiAgICB1c2VySWQ6IHN1cHBsaWVyVXNlcklkLFxuICAgIG1vYmlsZTogc3VwcGxpZXJNb2JpbGUsXG4gICAgdHlwZTogJ05FV19SRVFVRVNUJyxcbiAgICB0ZXh0LFxuICAgIGRhdGE6IHsgcmVxdWVzdElkLCB2ZWhpY2xlSW5mbywgcGFydHMgfSxcbiAgfSlcbn1cblxuLyoqXG4gKiBOb3RpZnkgZ2FyYWdlIGFib3V0IG5ldyBvZmZlclxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbm90aWZ5R2FyYWdlTmV3T2ZmZXIoXG4gIG9mZmVySWQ6IHN0cmluZyxcbiAgcmVxdWVzdElkOiBzdHJpbmcsXG4gIGdhcmFnZU1vYmlsZTogc3RyaW5nLFxuICBnYXJhZ2VVc2VySWQ6IHN0cmluZyxcbiAgc3VwcGxpZXJOYW1lOiBzdHJpbmcsXG4gIHN1cHBsaWVyUGhvbmU6IHN0cmluZyxcbiAgdmVoaWNsZUluZm86IHsgbWFrZTogc3RyaW5nOyBtb2RlbDogc3RyaW5nOyB5ZWFyPzogbnVtYmVyIH0sXG4gIHBhcnRzOiBzdHJpbmdbXSxcbiAgdG90YWxQcmljZTogbnVtYmVyXG4pIHtcbiAgY29uc3QgdmVoaWNsZURlc2MgPSBgJHt2ZWhpY2xlSW5mby5tYWtlfSAke3ZlaGljbGVJbmZvLm1vZGVsfSR7XG4gICAgdmVoaWNsZUluZm8ueWVhciA/IGAgJHt2ZWhpY2xlSW5mby55ZWFyfWAgOiAnJ1xuICB9YFxuICBjb25zdCBwYXJ0c0Rlc2MgPSBwYXJ0cy5qb2luKCcsICcpXG5cbiAgY29uc3QgdGV4dCA9IGBDYXJCb3Qg8J+al1xu16fXmdeR15zXqiDXlNem16LXlCDXl9eT16nXlCFcblxu16HXpNenOiAke3N1cHBsaWVyTmFtZX1cbteo15vXkTogJHt2ZWhpY2xlRGVzY31cbteX15zXp9eZ1506ICR7cGFydHNEZXNjfVxu157Xl9eZ16gg15vXldec15w6ICR7dG90YWxQcmljZS50b0xvY2FsZVN0cmluZygnaGUtSUwnKX0g4oKqXG5cbteY15zXpNeV158g16HXpNenOiAke3N1cHBsaWVyUGhvbmV9XG5cbtec16bXpNeZ15nXlCDXkdeU16bXoteV16o6XG4ke3Byb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTH0vZ2FyYWdlL3JlcXVlc3RzLyR7cmVxdWVzdElkfWBcblxuICBhd2FpdCBzZW5kTm90aWZpY2F0aW9uKHtcbiAgICB1c2VySWQ6IGdhcmFnZVVzZXJJZCxcbiAgICBtb2JpbGU6IGdhcmFnZU1vYmlsZSxcbiAgICB0eXBlOiAnTkVXX09GRkVSJyxcbiAgICB0ZXh0LFxuICAgIGRhdGE6IHsgb2ZmZXJJZCwgcmVxdWVzdElkLCBzdXBwbGllck5hbWUsIHRvdGFsUHJpY2UgfSxcbiAgfSlcbn1cblxuIl0sIm5hbWVzIjpbInByaXNtYSIsInNlbmRXaGF0c0FwcCIsImZvcm1hdFBob25lTnVtYmVyIiwic2VuZE5vdGlmaWNhdGlvbiIsInVzZXJJZCIsIm1vYmlsZSIsInR5cGUiLCJ0ZXh0IiwiZGF0YSIsImZvcm1hdHRlZE1vYmlsZSIsInJlc3VsdCIsIm5vdGlmaWNhdGlvbiIsImNyZWF0ZSIsIkpTT04iLCJwYXJzZSIsInN0cmluZ2lmeSIsInNlbnRWaWEiLCJzdWNjZXNzIiwiZXJyb3IiLCJtZXNzYWdlIiwiRXJyb3IiLCJub3RpZnlHYXJhZ2VSZXF1ZXN0Q3JlYXRlZCIsInJlcXVlc3RJZCIsImdhcmFnZU1vYmlsZSIsImdhcmFnZVVzZXJJZCIsInNsaWNlIiwibm90aWZ5U3VwcGxpZXJOZXdSZXF1ZXN0Iiwic3VwcGxpZXJNb2JpbGUiLCJzdXBwbGllclVzZXJJZCIsInZlaGljbGVJbmZvIiwicGFydHMiLCJ2ZWhpY2xlRGVzYyIsIm1ha2UiLCJtb2RlbCIsInllYXIiLCJwYXJ0c0Rlc2MiLCJqb2luIiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1VSTCIsIm5vdGlmeUdhcmFnZU5ld09mZmVyIiwib2ZmZXJJZCIsInN1cHBsaWVyTmFtZSIsInN1cHBsaWVyUGhvbmUiLCJ0b3RhbFByaWNlIiwidG9Mb2NhbGVTdHJpbmciXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/notifications.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE2QztBQUU3QyxNQUFNQyxrQkFBa0JDO0FBSWpCLE1BQU1DLFNBQVNGLGdCQUFnQkUsTUFBTSxJQUFJLElBQUlILHdEQUFZQSxHQUFFO0FBRWxFLElBQUlJLElBQXFDLEVBQUVILGdCQUFnQkUsTUFBTSxHQUFHQSIsInNvdXJjZXMiOlsiL1VzZXJzL3RhZG1pdGludGVyYWN0aXZlL2NhcmJvdG5leHQvbGliL3ByaXNtYS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcblxuY29uc3QgZ2xvYmFsRm9yUHJpc21hID0gZ2xvYmFsVGhpcyBhcyB1bmtub3duIGFzIHtcbiAgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCgpXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gcHJpc21hXG5cbiJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwicHJvY2VzcyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./lib/vehicle.ts":
/*!************************!*\
  !*** ./lib/vehicle.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   lookupVehicle: () => (/* binding */ lookupVehicle)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(rsc)/./lib/prisma.ts\");\n/**\n * Vehicle Lookup Service\n * \n * Handles vehicle lookups from gov.il API or mock data\n */ \n/**\n * Mock vehicle data for development/fallback\n */ const MOCK_VEHICLES = {\n    '12345678': {\n        plateNumber: '12345678',\n        make: 'Mazda',\n        model: '3',\n        year: 2018,\n        engine: '1.6',\n        color: ''\n    },\n    '87654321': {\n        plateNumber: '87654321',\n        make: 'Toyota',\n        model: 'Corolla',\n        year: 2020,\n        engine: '1.8',\n        color: '砖专'\n    },\n    '11111111': {\n        plateNumber: '11111111',\n        make: 'Mitsubishi',\n        model: 'Lancer',\n        year: 2017,\n        engine: '2.0',\n        color: '住祝'\n    },\n    '22222222': {\n        plateNumber: '22222222',\n        make: 'Honda',\n        model: 'Civic',\n        year: 2019,\n        engine: '1.5 Turbo',\n        color: ''\n    },\n    '33333333': {\n        plateNumber: '33333333',\n        make: 'Hyundai',\n        model: 'i30',\n        year: 2021,\n        engine: '1.4',\n        color: ''\n    }\n};\n/**\n * Fetch vehicle data from gov.il API\n */ async function fetchFromGovIl(plateNumber) {\n    const RESOURCE_ID = '053cea08-09bc-40ec-8f7a-156f0677aff3' // Vehicle registry resource\n    ;\n    const API_URL = 'https://data.gov.il/api/3/action/datastore_search';\n    try {\n        // Clean plate number - remove any non-digit characters\n        const cleanPlate = plateNumber.replace(/\\D/g, '');\n        // Build query URL\n        const url = new URL(API_URL);\n        url.searchParams.append('resource_id', RESOURCE_ID);\n        url.searchParams.append('q', cleanPlate);\n        url.searchParams.append('limit', '1');\n        console.log(' Fetching vehicle from gov.il:', cleanPlate);\n        const response = await fetch(url.toString(), {\n            method: 'GET',\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        });\n        if (!response.ok) {\n            console.error('Gov.il API error:', response.status, response.statusText);\n            return null;\n        }\n        const data = await response.json();\n        if (!data.success || !data.result.records || data.result.records.length === 0) {\n            console.log(' Vehicle not found in gov.il database');\n            return null;\n        }\n        const record = data.result.records[0];\n        // Parse year - handle both string and number\n        let year;\n        if (record.shnat_yitzur) {\n            const yearNum = typeof record.shnat_yitzur === 'string' ? parseInt(record.shnat_yitzur) : record.shnat_yitzur;\n            if (!isNaN(yearNum)) {\n                year = yearNum;\n            }\n        }\n        // Build engine description\n        let engine;\n        if (record.degem_manoa) {\n            engine = record.degem_manoa.toString();\n        }\n        const vehicleData = {\n            plateNumber: cleanPlate,\n            make: record.tozeret_nm || ' 注',\n            model: record.kinuy_mishari || record.degem_nm || ' 注',\n            year,\n            engine,\n            color: record.tzeva_rechev,\n            rawData: record\n        };\n        console.log(' Vehicle found:', vehicleData.make, vehicleData.model, vehicleData.year);\n        return vehicleData;\n    } catch (error) {\n        console.error('Error fetching from gov.il API:', error);\n        return null;\n    }\n}\n/**\n * Lookup vehicle by plate number\n * \n * Currently uses mock data, but ready for gov.il API integration\n */ async function lookupVehicle(plateNumber, userId) {\n    const USE_REAL_API = process.env.USE_GOV_API === 'true';\n    try {\n        // Check if vehicle already exists in database (cache)\n        const existingVehicle = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicle.findUnique({\n            where: {\n                plateNumber\n            }\n        });\n        if (existingVehicle) {\n            // Log the query\n            if (userId) {\n                await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicleQuery.create({\n                    data: {\n                        plateNumber,\n                        success: true,\n                        response: existingVehicle.rawData,\n                        userId\n                    }\n                });\n            }\n            return {\n                plateNumber: existingVehicle.plateNumber,\n                make: existingVehicle.make,\n                model: existingVehicle.model,\n                year: existingVehicle.year || undefined,\n                engine: existingVehicle.engine || undefined,\n                color: existingVehicle.color || undefined,\n                rawData: existingVehicle.rawData || undefined\n            };\n        }\n        let vehicleData = null;\n        // Try to fetch from gov.il API if enabled\n        if (USE_REAL_API) {\n            console.log(' Using gov.il API');\n            vehicleData = await fetchFromGovIl(plateNumber);\n        }\n        // Fallback to mock data if API is disabled or failed\n        if (!vehicleData) {\n            console.log(' Using mock data');\n            vehicleData = MOCK_VEHICLES[plateNumber] || null;\n        }\n        // Log the query result\n        if (userId) {\n            await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicleQuery.create({\n                data: {\n                    plateNumber,\n                    success: vehicleData !== null,\n                    response: vehicleData,\n                    userId\n                }\n            });\n        }\n        return vehicleData;\n    } catch (error) {\n        console.error('Vehicle lookup error:', error);\n        // Log failed query\n        if (userId) {\n            await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.vehicleQuery.create({\n                data: {\n                    plateNumber,\n                    success: false,\n                    response: null,\n                    userId\n                }\n            });\n        }\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixRQUFRQyxHQUFHLENBQUM7WUFDWnNCLGNBQWN2QyxhQUFhLENBQUNDLFlBQVksSUFBSTtRQUM5QztRQUVBLHVCQUF1QjtRQUN2QixJQUFJNkMsUUFBUTtZQUNWLE1BQU0vQywyQ0FBTUEsQ0FBQ3dELFlBQVksQ0FBQ0MsTUFBTSxDQUFDO2dCQUMvQjdCLE1BQU07b0JBQ0oxQjtvQkFDQTRCLFNBQVNVLGdCQUFnQjtvQkFDekJyQixVQUFVcUI7b0JBQ1ZPO2dCQUNGO1lBQ0Y7UUFDRjtRQUVBLE9BQU9QO0lBQ1QsRUFBRSxPQUFPZixPQUFPO1FBQ2RSLFFBQVFRLEtBQUssQ0FBQyx5QkFBeUJBO1FBRXZDLG1CQUFtQjtRQUNuQixJQUFJc0IsUUFBUTtZQUNWLE1BQU0vQywyQ0FBTUEsQ0FBQ3dELFlBQVksQ0FBQ0MsTUFBTSxDQUFDO2dCQUMvQjdCLE1BQU07b0JBQ0oxQjtvQkFDQTRCLFNBQVM7b0JBQ1RYLFVBQVU7b0JBQ1Y0QjtnQkFDRjtZQUNGO1FBQ0Y7UUFFQSxNQUFNdEI7SUFDUjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvdGFkbWl0aW50ZXJhY3RpdmUvY2FyYm90bmV4dC9saWIvdmVoaWNsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFZlaGljbGUgTG9va3VwIFNlcnZpY2VcbiAqIFxuICogSGFuZGxlcyB2ZWhpY2xlIGxvb2t1cHMgZnJvbSBnb3YuaWwgQVBJIG9yIG1vY2sgZGF0YVxuICovXG5cbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4vcHJpc21hJ1xuXG5pbnRlcmZhY2UgVmVoaWNsZURhdGEge1xuICBwbGF0ZU51bWJlcjogc3RyaW5nXG4gIG1ha2U6IHN0cmluZ1xuICBtb2RlbDogc3RyaW5nXG4gIHllYXI/OiBudW1iZXJcbiAgZW5naW5lPzogc3RyaW5nXG4gIGNvbG9yPzogc3RyaW5nXG4gIHJhd0RhdGE/OiBhbnlcbn1cblxuLyoqXG4gKiBHb3YuaWwgQVBJIFJlc3BvbnNlIEludGVyZmFjZVxuICovXG5pbnRlcmZhY2UgR292SWxWZWhpY2xlUmVjb3JkIHtcbiAgbWlzcGFyX3JlY2hldjogc3RyaW5nIHwgbnVtYmVyIC8vINee16HXpNeoINeo15vXkVxuICB0b3plcmV0X25tOiBzdHJpbmcgLy8g15nXpteo159cbiAga2ludXlfbWlzaGFyaTogc3RyaW5nIC8vINeT15LXnVxuICBzaG5hdF95aXR6dXI6IHN0cmluZyB8IG51bWJlciAvLyDXqdeg16og15nXmdem15XXqFxuICBkZWdlbV9ubT86IHN0cmluZyAvLyDXk9eS150g16DXldeh16NcbiAgcmFtYXRfZ2ltdXI/OiBzdHJpbmcgLy8g16jXnteqINeS15nXnteV16hcbiAgdHpldmFfcmVjaGV2Pzogc3RyaW5nIC8vINem15HXolxuICBrdnV0emF0X3ppaHVtPzogc3RyaW5nIC8vINen15HXldem16og15bXmdeU15XXnVxuICBkZWdlbV9tYW5vYT86IHN0cmluZyB8IG51bWJlciAvLyDXk9eS150g157XoNeV16JcbiAgW2tleTogc3RyaW5nXTogYW55IC8vINep15PXldeqINeg15XXodek15nXnVxufVxuXG5pbnRlcmZhY2UgR292SWxBcGlSZXNwb25zZSB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW5cbiAgcmVzdWx0OiB7XG4gICAgcmVjb3JkczogR292SWxWZWhpY2xlUmVjb3JkW11cbiAgICB0b3RhbDogbnVtYmVyXG4gIH1cbn1cblxuLyoqXG4gKiBNb2NrIHZlaGljbGUgZGF0YSBmb3IgZGV2ZWxvcG1lbnQvZmFsbGJhY2tcbiAqL1xuY29uc3QgTU9DS19WRUhJQ0xFUzogUmVjb3JkPHN0cmluZywgVmVoaWNsZURhdGE+ID0ge1xuICAnMTIzNDU2NzgnOiB7XG4gICAgcGxhdGVOdW1iZXI6ICcxMjM0NTY3OCcsXG4gICAgbWFrZTogJ01hemRhJyxcbiAgICBtb2RlbDogJzMnLFxuICAgIHllYXI6IDIwMTgsXG4gICAgZW5naW5lOiAnMS42JyxcbiAgICBjb2xvcjogJ9ec15HXnycsXG4gIH0sXG4gICc4NzY1NDMyMSc6IHtcbiAgICBwbGF0ZU51bWJlcjogJzg3NjU0MzIxJyxcbiAgICBtYWtlOiAnVG95b3RhJyxcbiAgICBtb2RlbDogJ0Nvcm9sbGEnLFxuICAgIHllYXI6IDIwMjAsXG4gICAgZW5naW5lOiAnMS44JyxcbiAgICBjb2xvcjogJ9ep15fXldeoJyxcbiAgfSxcbiAgJzExMTExMTExJzoge1xuICAgIHBsYXRlTnVtYmVyOiAnMTExMTExMTEnLFxuICAgIG1ha2U6ICdNaXRzdWJpc2hpJyxcbiAgICBtb2RlbDogJ0xhbmNlcicsXG4gICAgeWVhcjogMjAxNyxcbiAgICBlbmdpbmU6ICcyLjAnLFxuICAgIGNvbG9yOiAn15vXodejJyxcbiAgfSxcbiAgJzIyMjIyMjIyJzoge1xuICAgIHBsYXRlTnVtYmVyOiAnMjIyMjIyMjInLFxuICAgIG1ha2U6ICdIb25kYScsXG4gICAgbW9kZWw6ICdDaXZpYycsXG4gICAgeWVhcjogMjAxOSxcbiAgICBlbmdpbmU6ICcxLjUgVHVyYm8nLFxuICAgIGNvbG9yOiAn15DXk9eV150nLFxuICB9LFxuICAnMzMzMzMzMzMnOiB7XG4gICAgcGxhdGVOdW1iZXI6ICczMzMzMzMzMycsXG4gICAgbWFrZTogJ0h5dW5kYWknLFxuICAgIG1vZGVsOiAnaTMwJyxcbiAgICB5ZWFyOiAyMDIxLFxuICAgIGVuZ2luZTogJzEuNCcsXG4gICAgY29sb3I6ICfXm9eX15XXnCcsXG4gIH0sXG59XG5cbi8qKlxuICogRmV0Y2ggdmVoaWNsZSBkYXRhIGZyb20gZ292LmlsIEFQSVxuICovXG5hc3luYyBmdW5jdGlvbiBmZXRjaEZyb21Hb3ZJbChwbGF0ZU51bWJlcjogc3RyaW5nKTogUHJvbWlzZTxWZWhpY2xlRGF0YSB8IG51bGw+IHtcbiAgY29uc3QgUkVTT1VSQ0VfSUQgPSAnMDUzY2VhMDgtMDliYy00MGVjLThmN2EtMTU2ZjA2NzdhZmYzJyAvLyBWZWhpY2xlIHJlZ2lzdHJ5IHJlc291cmNlXG4gIGNvbnN0IEFQSV9VUkwgPSAnaHR0cHM6Ly9kYXRhLmdvdi5pbC9hcGkvMy9hY3Rpb24vZGF0YXN0b3JlX3NlYXJjaCdcblxuICB0cnkge1xuICAgIC8vIENsZWFuIHBsYXRlIG51bWJlciAtIHJlbW92ZSBhbnkgbm9uLWRpZ2l0IGNoYXJhY3RlcnNcbiAgICBjb25zdCBjbGVhblBsYXRlID0gcGxhdGVOdW1iZXIucmVwbGFjZSgvXFxEL2csICcnKVxuXG4gICAgLy8gQnVpbGQgcXVlcnkgVVJMXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChBUElfVVJMKVxuICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdyZXNvdXJjZV9pZCcsIFJFU09VUkNFX0lEKVxuICAgIHVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdxJywgY2xlYW5QbGF0ZSlcbiAgICB1cmwuc2VhcmNoUGFyYW1zLmFwcGVuZCgnbGltaXQnLCAnMScpXG5cbiAgICBjb25zb2xlLmxvZygn8J+UjSBGZXRjaGluZyB2ZWhpY2xlIGZyb20gZ292LmlsOicsIGNsZWFuUGxhdGUpXG5cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybC50b1N0cmluZygpLCB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc29sZS5lcnJvcignR292LmlsIEFQSSBlcnJvcjonLCByZXNwb25zZS5zdGF0dXMsIHJlc3BvbnNlLnN0YXR1c1RleHQpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IGRhdGE6IEdvdklsQXBpUmVzcG9uc2UgPSBhd2FpdCByZXNwb25zZS5qc29uKClcblxuICAgIGlmICghZGF0YS5zdWNjZXNzIHx8ICFkYXRhLnJlc3VsdC5yZWNvcmRzIHx8IGRhdGEucmVzdWx0LnJlY29yZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZygn4p2MIFZlaGljbGUgbm90IGZvdW5kIGluIGdvdi5pbCBkYXRhYmFzZScpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IHJlY29yZCA9IGRhdGEucmVzdWx0LnJlY29yZHNbMF1cblxuICAgIC8vIFBhcnNlIHllYXIgLSBoYW5kbGUgYm90aCBzdHJpbmcgYW5kIG51bWJlclxuICAgIGxldCB5ZWFyOiBudW1iZXIgfCB1bmRlZmluZWRcbiAgICBpZiAocmVjb3JkLnNobmF0X3lpdHp1cikge1xuICAgICAgY29uc3QgeWVhck51bSA9IHR5cGVvZiByZWNvcmQuc2huYXRfeWl0enVyID09PSAnc3RyaW5nJyBcbiAgICAgICAgPyBwYXJzZUludChyZWNvcmQuc2huYXRfeWl0enVyKSBcbiAgICAgICAgOiByZWNvcmQuc2huYXRfeWl0enVyXG4gICAgICBpZiAoIWlzTmFOKHllYXJOdW0pKSB7XG4gICAgICAgIHllYXIgPSB5ZWFyTnVtXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgZW5naW5lIGRlc2NyaXB0aW9uXG4gICAgbGV0IGVuZ2luZTogc3RyaW5nIHwgdW5kZWZpbmVkXG4gICAgaWYgKHJlY29yZC5kZWdlbV9tYW5vYSkge1xuICAgICAgZW5naW5lID0gcmVjb3JkLmRlZ2VtX21hbm9hLnRvU3RyaW5nKClcbiAgICB9XG5cbiAgICBjb25zdCB2ZWhpY2xlRGF0YTogVmVoaWNsZURhdGEgPSB7XG4gICAgICBwbGF0ZU51bWJlcjogY2xlYW5QbGF0ZSxcbiAgICAgIG1ha2U6IHJlY29yZC50b3plcmV0X25tIHx8ICfXnNeQINeZ15PXldeiJyxcbiAgICAgIG1vZGVsOiByZWNvcmQua2ludXlfbWlzaGFyaSB8fCByZWNvcmQuZGVnZW1fbm0gfHwgJ9ec15Ag15nXk9eV16InLFxuICAgICAgeWVhcixcbiAgICAgIGVuZ2luZSxcbiAgICAgIGNvbG9yOiByZWNvcmQudHpldmFfcmVjaGV2LFxuICAgICAgcmF3RGF0YTogcmVjb3JkLFxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCfinIUgVmVoaWNsZSBmb3VuZDonLCB2ZWhpY2xlRGF0YS5tYWtlLCB2ZWhpY2xlRGF0YS5tb2RlbCwgdmVoaWNsZURhdGEueWVhcilcblxuICAgIHJldHVybiB2ZWhpY2xlRGF0YVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGZyb20gZ292LmlsIEFQSTonLCBlcnJvcilcbiAgICByZXR1cm4gbnVsbFxuICB9XG59XG5cbi8qKlxuICogTG9va3VwIHZlaGljbGUgYnkgcGxhdGUgbnVtYmVyXG4gKiBcbiAqIEN1cnJlbnRseSB1c2VzIG1vY2sgZGF0YSwgYnV0IHJlYWR5IGZvciBnb3YuaWwgQVBJIGludGVncmF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb29rdXBWZWhpY2xlKFxuICBwbGF0ZU51bWJlcjogc3RyaW5nLFxuICB1c2VySWQ/OiBzdHJpbmdcbik6IFByb21pc2U8VmVoaWNsZURhdGEgfCBudWxsPiB7XG4gIGNvbnN0IFVTRV9SRUFMX0FQSSA9IHByb2Nlc3MuZW52LlVTRV9HT1ZfQVBJID09PSAndHJ1ZSdcblxuICB0cnkge1xuICAgIC8vIENoZWNrIGlmIHZlaGljbGUgYWxyZWFkeSBleGlzdHMgaW4gZGF0YWJhc2UgKGNhY2hlKVxuICAgIGNvbnN0IGV4aXN0aW5nVmVoaWNsZSA9IGF3YWl0IHByaXNtYS52ZWhpY2xlLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgcGxhdGVOdW1iZXIgfSxcbiAgICB9KVxuXG4gICAgaWYgKGV4aXN0aW5nVmVoaWNsZSkge1xuICAgICAgLy8gTG9nIHRoZSBxdWVyeVxuICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICBhd2FpdCBwcmlzbWEudmVoaWNsZVF1ZXJ5LmNyZWF0ZSh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgcGxhdGVOdW1iZXIsXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgcmVzcG9uc2U6IGV4aXN0aW5nVmVoaWNsZS5yYXdEYXRhIGFzIGFueSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwbGF0ZU51bWJlcjogZXhpc3RpbmdWZWhpY2xlLnBsYXRlTnVtYmVyLFxuICAgICAgICBtYWtlOiBleGlzdGluZ1ZlaGljbGUubWFrZSxcbiAgICAgICAgbW9kZWw6IGV4aXN0aW5nVmVoaWNsZS5tb2RlbCxcbiAgICAgICAgeWVhcjogZXhpc3RpbmdWZWhpY2xlLnllYXIgfHwgdW5kZWZpbmVkLFxuICAgICAgICBlbmdpbmU6IGV4aXN0aW5nVmVoaWNsZS5lbmdpbmUgfHwgdW5kZWZpbmVkLFxuICAgICAgICBjb2xvcjogZXhpc3RpbmdWZWhpY2xlLmNvbG9yIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgcmF3RGF0YTogZXhpc3RpbmdWZWhpY2xlLnJhd0RhdGEgfHwgdW5kZWZpbmVkLFxuICAgICAgfVxuICAgIH1cblxuICAgIGxldCB2ZWhpY2xlRGF0YTogVmVoaWNsZURhdGEgfCBudWxsID0gbnVsbFxuXG4gICAgLy8gVHJ5IHRvIGZldGNoIGZyb20gZ292LmlsIEFQSSBpZiBlbmFibGVkXG4gICAgaWYgKFVTRV9SRUFMX0FQSSkge1xuICAgICAgY29uc29sZS5sb2coJ/CfjJAgVXNpbmcgZ292LmlsIEFQSScpXG4gICAgICB2ZWhpY2xlRGF0YSA9IGF3YWl0IGZldGNoRnJvbUdvdklsKHBsYXRlTnVtYmVyKVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIG1vY2sgZGF0YSBpZiBBUEkgaXMgZGlzYWJsZWQgb3IgZmFpbGVkXG4gICAgaWYgKCF2ZWhpY2xlRGF0YSkge1xuICAgICAgY29uc29sZS5sb2coJ/Cfk6YgVXNpbmcgbW9jayBkYXRhJylcbiAgICAgIHZlaGljbGVEYXRhID0gTU9DS19WRUhJQ0xFU1twbGF0ZU51bWJlcl0gfHwgbnVsbFxuICAgIH1cblxuICAgIC8vIExvZyB0aGUgcXVlcnkgcmVzdWx0XG4gICAgaWYgKHVzZXJJZCkge1xuICAgICAgYXdhaXQgcHJpc21hLnZlaGljbGVRdWVyeS5jcmVhdGUoe1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgcGxhdGVOdW1iZXIsXG4gICAgICAgICAgc3VjY2VzczogdmVoaWNsZURhdGEgIT09IG51bGwsXG4gICAgICAgICAgcmVzcG9uc2U6IHZlaGljbGVEYXRhIGFzIGFueSxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiB2ZWhpY2xlRGF0YVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZlaGljbGUgbG9va3VwIGVycm9yOicsIGVycm9yKVxuXG4gICAgLy8gTG9nIGZhaWxlZCBxdWVyeVxuICAgIGlmICh1c2VySWQpIHtcbiAgICAgIGF3YWl0IHByaXNtYS52ZWhpY2xlUXVlcnkuY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIHBsYXRlTnVtYmVyLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIHJlc3BvbnNlOiBudWxsLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG4vKipcbiAqIEV4cG9ydCBmb3IgdXNlIGluIGNvbXBvbmVudHNcbiAqL1xuZXhwb3J0IHR5cGUgeyBWZWhpY2xlRGF0YSB9XG5cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJNT0NLX1ZFSElDTEVTIiwicGxhdGVOdW1iZXIiLCJtYWtlIiwibW9kZWwiLCJ5ZWFyIiwiZW5naW5lIiwiY29sb3IiLCJmZXRjaEZyb21Hb3ZJbCIsIlJFU09VUkNFX0lEIiwiQVBJX1VSTCIsImNsZWFuUGxhdGUiLCJyZXBsYWNlIiwidXJsIiwiVVJMIiwic2VhcmNoUGFyYW1zIiwiYXBwZW5kIiwiY29uc29sZSIsImxvZyIsInJlc3BvbnNlIiwiZmV0Y2giLCJ0b1N0cmluZyIsIm1ldGhvZCIsImhlYWRlcnMiLCJvayIsImVycm9yIiwic3RhdHVzIiwic3RhdHVzVGV4dCIsImRhdGEiLCJqc29uIiwic3VjY2VzcyIsInJlc3VsdCIsInJlY29yZHMiLCJsZW5ndGgiLCJyZWNvcmQiLCJzaG5hdF95aXR6dXIiLCJ5ZWFyTnVtIiwicGFyc2VJbnQiLCJpc05hTiIsImRlZ2VtX21hbm9hIiwidmVoaWNsZURhdGEiLCJ0b3plcmV0X25tIiwia2ludXlfbWlzaGFyaSIsImRlZ2VtX25tIiwidHpldmFfcmVjaGV2IiwicmF3RGF0YSIsImxvb2t1cFZlaGljbGUiLCJ1c2VySWQiLCJVU0VfUkVBTF9BUEkiLCJwcm9jZXNzIiwiZW52IiwiVVNFX0dPVl9BUEkiLCJleGlzdGluZ1ZlaGljbGUiLCJ2ZWhpY2xlIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwidmVoaWNsZVF1ZXJ5IiwiY3JlYXRlIiwidW5kZWZpbmVkIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/vehicle.ts\n");

/***/ }),

/***/ "(rsc)/./lib/whatsapp.ts":
/*!*************************!*\
  !*** ./lib/whatsapp.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   formatPhoneNumber: () => (/* binding */ formatPhoneNumber),\n/* harmony export */   sendWhatsApp: () => (/* binding */ sendWhatsApp),\n/* harmony export */   sendWhatsAppTemplate: () => (/* binding */ sendWhatsAppTemplate)\n/* harmony export */ });\n/**\n * RappelSend WhatsApp Integration\n * \n * This service handles all WhatsApp notifications via RappelSend API\n */ /**\n * Send a text message via WhatsApp\n * \n * @param mobile - Phone number in international format (e.g., \"972542284283\")\n * @param text - Message text\n * @returns Response from RappelSend API\n */ async function sendWhatsApp(mobile, text) {\n    // Check if API credentials are configured\n    const clientId = process.env.RAPPEL_CLIENT_ID;\n    const apiKey = process.env.RAPPEL_API_KEY;\n    // If not configured or using placeholder values, return mock success\n    if (!clientId || !apiKey || clientId === 'YOUR_CLIENT_ID' || apiKey === 'YOUR_API_KEYS') {\n        console.log(' WhatsApp (Mock Mode):', mobile, text.substring(0, 50) + '...');\n        return {\n            success: true,\n            message: 'Mock message sent (API not configured)'\n        };\n    }\n    const url = 'https://rappelsend.com/api/user/v2/send_message';\n    const body = {\n        client_id: clientId,\n        mobile,\n        text\n    };\n    const headers = {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${apiKey}`\n    };\n    try {\n        const res = await fetch(url, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body)\n        });\n        if (!res.ok) {\n            const errorText = await res.text();\n            console.error('RappelSend API error:', res.status, errorText);\n            return {\n                success: false,\n                message: `RappelSend API error: ${res.status}`\n            };\n        }\n        const data = await res.json();\n        console.log(' WhatsApp sent successfully:', mobile);\n        return data;\n    } catch (error) {\n        console.error('WhatsApp send error:', error);\n        return {\n            success: false,\n            message: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Send a template message via WhatsApp\n * \n * @param mobile - Phone number in international format\n * @param templetId - Template ID from RappelSend\n * @returns Response from RappelSend API\n */ async function sendWhatsAppTemplate(mobile, templetId) {\n    // Check if API credentials are configured\n    const clientId = process.env.RAPPEL_CLIENT_ID;\n    const apiKey = process.env.RAPPEL_API_KEY;\n    // If not configured or using placeholder values, return mock success\n    if (!clientId || !apiKey || clientId === 'YOUR_CLIENT_ID' || apiKey === 'YOUR_API_KEYS') {\n        console.log(' WhatsApp Template (Mock Mode):', mobile, templetId);\n        return {\n            success: true,\n            message: 'Mock template sent (API not configured)'\n        };\n    }\n    const url = 'https://rappelsend.com/api/user/v2/send_templet';\n    const body = {\n        client_id: clientId,\n        mobile,\n        templet_id: templetId\n    };\n    const headers = {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${apiKey}`\n    };\n    try {\n        const res = await fetch(url, {\n            method: 'POST',\n            headers,\n            body: JSON.stringify(body)\n        });\n        if (!res.ok) {\n            const errorText = await res.text();\n            console.error('RappelSend API error:', res.status, errorText);\n            return {\n                success: false,\n                message: `RappelSend API error: ${res.status}`\n            };\n        }\n        const data = await res.json();\n        console.log(' WhatsApp template sent successfully:', mobile);\n        return data;\n    } catch (error) {\n        console.error('WhatsApp template send error:', error);\n        return {\n            success: false,\n            message: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Format phone number to international format\n * Assumes Israeli phone numbers if not prefixed\n * \n * @param phone - Phone number (e.g., \"054-2284283\" or \"0542284283\")\n * @returns Formatted phone number (e.g., \"972542284283\")\n */ function formatPhoneNumber(phone) {\n    // Remove all non-digit characters\n    const cleaned = phone.replace(/\\D/g, '');\n    // If starts with 0, replace with 972 (Israel country code)\n    if (cleaned.startsWith('0')) {\n        return '972' + cleaned.substring(1);\n    }\n    // If starts with 972, return as is\n    if (cleaned.startsWith('972')) {\n        return cleaned;\n    }\n    // Otherwise, assume Israeli number and add prefix\n    return '972' + cleaned;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFHLENBQUMsMkNBQTJDVDtRQUN2RCxPQUFPMkI7SUFDVCxFQUFFLE9BQU9GLE9BQU87UUFDZGpCLFFBQVFpQixLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyxPQUFPO1lBQ0xkLFNBQVM7WUFDVEMsU0FBU2EsaUJBQWlCSSxRQUFRSixNQUFNYixPQUFPLEdBQUc7UUFDcEQ7SUFDRjtBQUNGO0FBRUE7Ozs7OztDQU1DLEdBQ00sU0FBU3FCLGtCQUFrQkMsS0FBYTtJQUM3QyxrQ0FBa0M7SUFDbEMsTUFBTUMsVUFBVUQsTUFBTUUsT0FBTyxDQUFDLE9BQU87SUFFckMsMkRBQTJEO0lBQzNELElBQUlELFFBQVFFLFVBQVUsQ0FBQyxNQUFNO1FBQzNCLE9BQU8sUUFBUUYsUUFBUXpCLFNBQVMsQ0FBQztJQUNuQztJQUVBLG1DQUFtQztJQUNuQyxJQUFJeUIsUUFBUUUsVUFBVSxDQUFDLFFBQVE7UUFDN0IsT0FBT0Y7SUFDVDtJQUVBLGtEQUFrRDtJQUNsRCxPQUFPLFFBQVFBO0FBQ2pCIiwic291cmNlcyI6WyIvVXNlcnMvdGFkbWl0aW50ZXJhY3RpdmUvY2FyYm90bmV4dC9saWIvd2hhdHNhcHAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSYXBwZWxTZW5kIFdoYXRzQXBwIEludGVncmF0aW9uXG4gKiBcbiAqIFRoaXMgc2VydmljZSBoYW5kbGVzIGFsbCBXaGF0c0FwcCBub3RpZmljYXRpb25zIHZpYSBSYXBwZWxTZW5kIEFQSVxuICovXG5cbmludGVyZmFjZSBTZW5kTWVzc2FnZVJlc3BvbnNlIHtcbiAgc3VjY2VzczogYm9vbGVhblxuICBtZXNzYWdlOiBzdHJpbmdcbiAgZGF0YT86IGFueVxufVxuXG5pbnRlcmZhY2UgU2VuZFRlbXBsYXRlUmVzcG9uc2Uge1xuICBzdWNjZXNzOiBib29sZWFuXG4gIG1lc3NhZ2U6IHN0cmluZ1xuICBkYXRhPzogYW55XG59XG5cbi8qKlxuICogU2VuZCBhIHRleHQgbWVzc2FnZSB2aWEgV2hhdHNBcHBcbiAqIFxuICogQHBhcmFtIG1vYmlsZSAtIFBob25lIG51bWJlciBpbiBpbnRlcm5hdGlvbmFsIGZvcm1hdCAoZS5nLiwgXCI5NzI1NDIyODQyODNcIilcbiAqIEBwYXJhbSB0ZXh0IC0gTWVzc2FnZSB0ZXh0XG4gKiBAcmV0dXJucyBSZXNwb25zZSBmcm9tIFJhcHBlbFNlbmQgQVBJXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kV2hhdHNBcHAoXG4gIG1vYmlsZTogc3RyaW5nLFxuICB0ZXh0OiBzdHJpbmdcbik6IFByb21pc2U8U2VuZE1lc3NhZ2VSZXNwb25zZT4ge1xuICAvLyBDaGVjayBpZiBBUEkgY3JlZGVudGlhbHMgYXJlIGNvbmZpZ3VyZWRcbiAgY29uc3QgY2xpZW50SWQgPSBwcm9jZXNzLmVudi5SQVBQRUxfQ0xJRU5UX0lEXG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlJBUFBFTF9BUElfS0VZXG5cbiAgLy8gSWYgbm90IGNvbmZpZ3VyZWQgb3IgdXNpbmcgcGxhY2Vob2xkZXIgdmFsdWVzLCByZXR1cm4gbW9jayBzdWNjZXNzXG4gIGlmIChcbiAgICAhY2xpZW50SWQgfHxcbiAgICAhYXBpS2V5IHx8XG4gICAgY2xpZW50SWQgPT09ICdZT1VSX0NMSUVOVF9JRCcgfHxcbiAgICBhcGlLZXkgPT09ICdZT1VSX0FQSV9LRVlTJ1xuICApIHtcbiAgICBjb25zb2xlLmxvZygn8J+TsSBXaGF0c0FwcCAoTW9jayBNb2RlKTonLCBtb2JpbGUsIHRleHQuc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nKVxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ01vY2sgbWVzc2FnZSBzZW50IChBUEkgbm90IGNvbmZpZ3VyZWQpJyxcbiAgICB9XG4gIH1cblxuICBjb25zdCB1cmwgPSAnaHR0cHM6Ly9yYXBwZWxzZW5kLmNvbS9hcGkvdXNlci92Mi9zZW5kX21lc3NhZ2UnXG5cbiAgY29uc3QgYm9keSA9IHtcbiAgICBjbGllbnRfaWQ6IGNsaWVudElkLFxuICAgIG1vYmlsZSxcbiAgICB0ZXh0LFxuICB9XG5cbiAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHthcGlLZXl9YCxcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSxcbiAgICB9KVxuXG4gICAgaWYgKCFyZXMub2spIHtcbiAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlcy50ZXh0KClcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JhcHBlbFNlbmQgQVBJIGVycm9yOicsIHJlcy5zdGF0dXMsIGVycm9yVGV4dClcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBgUmFwcGVsU2VuZCBBUEkgZXJyb3I6ICR7cmVzLnN0YXR1c31gLFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpXG4gICAgY29uc29sZS5sb2coJ/Cfk7EgV2hhdHNBcHAgc2VudCBzdWNjZXNzZnVsbHk6JywgbW9iaWxlKVxuICAgIHJldHVybiBkYXRhXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignV2hhdHNBcHAgc2VuZCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBTZW5kIGEgdGVtcGxhdGUgbWVzc2FnZSB2aWEgV2hhdHNBcHBcbiAqIFxuICogQHBhcmFtIG1vYmlsZSAtIFBob25lIG51bWJlciBpbiBpbnRlcm5hdGlvbmFsIGZvcm1hdFxuICogQHBhcmFtIHRlbXBsZXRJZCAtIFRlbXBsYXRlIElEIGZyb20gUmFwcGVsU2VuZFxuICogQHJldHVybnMgUmVzcG9uc2UgZnJvbSBSYXBwZWxTZW5kIEFQSVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZFdoYXRzQXBwVGVtcGxhdGUoXG4gIG1vYmlsZTogc3RyaW5nLFxuICB0ZW1wbGV0SWQ6IG51bWJlclxuKTogUHJvbWlzZTxTZW5kVGVtcGxhdGVSZXNwb25zZT4ge1xuICAvLyBDaGVjayBpZiBBUEkgY3JlZGVudGlhbHMgYXJlIGNvbmZpZ3VyZWRcbiAgY29uc3QgY2xpZW50SWQgPSBwcm9jZXNzLmVudi5SQVBQRUxfQ0xJRU5UX0lEXG4gIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlJBUFBFTF9BUElfS0VZXG5cbiAgLy8gSWYgbm90IGNvbmZpZ3VyZWQgb3IgdXNpbmcgcGxhY2Vob2xkZXIgdmFsdWVzLCByZXR1cm4gbW9jayBzdWNjZXNzXG4gIGlmIChcbiAgICAhY2xpZW50SWQgfHxcbiAgICAhYXBpS2V5IHx8XG4gICAgY2xpZW50SWQgPT09ICdZT1VSX0NMSUVOVF9JRCcgfHxcbiAgICBhcGlLZXkgPT09ICdZT1VSX0FQSV9LRVlTJ1xuICApIHtcbiAgICBjb25zb2xlLmxvZygn8J+TsSBXaGF0c0FwcCBUZW1wbGF0ZSAoTW9jayBNb2RlKTonLCBtb2JpbGUsIHRlbXBsZXRJZClcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIG1lc3NhZ2U6ICdNb2NrIHRlbXBsYXRlIHNlbnQgKEFQSSBub3QgY29uZmlndXJlZCknLFxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHVybCA9ICdodHRwczovL3JhcHBlbHNlbmQuY29tL2FwaS91c2VyL3YyL3NlbmRfdGVtcGxldCdcblxuICBjb25zdCBib2R5ID0ge1xuICAgIGNsaWVudF9pZDogY2xpZW50SWQsXG4gICAgbW9iaWxlLFxuICAgIHRlbXBsZXRfaWQ6IHRlbXBsZXRJZCxcbiAgfVxuXG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7YXBpS2V5fWAsXG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgfSlcblxuICAgIGlmICghcmVzLm9rKSB7XG4gICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXMudGV4dCgpXG4gICAgICBjb25zb2xlLmVycm9yKCdSYXBwZWxTZW5kIEFQSSBlcnJvcjonLCByZXMuc3RhdHVzLCBlcnJvclRleHQpXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogYFJhcHBlbFNlbmQgQVBJIGVycm9yOiAke3Jlcy5zdGF0dXN9YCxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKVxuICAgIGNvbnNvbGUubG9nKCfwn5OxIFdoYXRzQXBwIHRlbXBsYXRlIHNlbnQgc3VjY2Vzc2Z1bGx5OicsIG1vYmlsZSlcbiAgICByZXR1cm4gZGF0YVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1doYXRzQXBwIHRlbXBsYXRlIHNlbmQgZXJyb3I6JywgZXJyb3IpXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRm9ybWF0IHBob25lIG51bWJlciB0byBpbnRlcm5hdGlvbmFsIGZvcm1hdFxuICogQXNzdW1lcyBJc3JhZWxpIHBob25lIG51bWJlcnMgaWYgbm90IHByZWZpeGVkXG4gKiBcbiAqIEBwYXJhbSBwaG9uZSAtIFBob25lIG51bWJlciAoZS5nLiwgXCIwNTQtMjI4NDI4M1wiIG9yIFwiMDU0MjI4NDI4M1wiKVxuICogQHJldHVybnMgRm9ybWF0dGVkIHBob25lIG51bWJlciAoZS5nLiwgXCI5NzI1NDIyODQyODNcIilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFBob25lTnVtYmVyKHBob25lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBSZW1vdmUgYWxsIG5vbi1kaWdpdCBjaGFyYWN0ZXJzXG4gIGNvbnN0IGNsZWFuZWQgPSBwaG9uZS5yZXBsYWNlKC9cXEQvZywgJycpXG4gIFxuICAvLyBJZiBzdGFydHMgd2l0aCAwLCByZXBsYWNlIHdpdGggOTcyIChJc3JhZWwgY291bnRyeSBjb2RlKVxuICBpZiAoY2xlYW5lZC5zdGFydHNXaXRoKCcwJykpIHtcbiAgICByZXR1cm4gJzk3MicgKyBjbGVhbmVkLnN1YnN0cmluZygxKVxuICB9XG4gIFxuICAvLyBJZiBzdGFydHMgd2l0aCA5NzIsIHJldHVybiBhcyBpc1xuICBpZiAoY2xlYW5lZC5zdGFydHNXaXRoKCc5NzInKSkge1xuICAgIHJldHVybiBjbGVhbmVkXG4gIH1cbiAgXG4gIC8vIE90aGVyd2lzZSwgYXNzdW1lIElzcmFlbGkgbnVtYmVyIGFuZCBhZGQgcHJlZml4XG4gIHJldHVybiAnOTcyJyArIGNsZWFuZWRcbn1cblxuIl0sIm5hbWVzIjpbInNlbmRXaGF0c0FwcCIsIm1vYmlsZSIsInRleHQiLCJjbGllbnRJZCIsInByb2Nlc3MiLCJlbnYiLCJSQVBQRUxfQ0xJRU5UX0lEIiwiYXBpS2V5IiwiUkFQUEVMX0FQSV9LRVkiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJ1cmwiLCJib2R5IiwiY2xpZW50X2lkIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJyZXMiLCJmZXRjaCIsIm1ldGhvZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsImVycm9yVGV4dCIsImVycm9yIiwic3RhdHVzIiwiZGF0YSIsImpzb24iLCJFcnJvciIsInNlbmRXaGF0c0FwcFRlbXBsYXRlIiwidGVtcGxldElkIiwidGVtcGxldF9pZCIsImZvcm1hdFBob25lTnVtYmVyIiwicGhvbmUiLCJjbGVhbmVkIiwicmVwbGFjZSIsInN0YXJ0c1dpdGgiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/whatsapp.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/./node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/./node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/./node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/./node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/./node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/./node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/./node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/./node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/./node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var _Users_tadmitinteractive_carbotnext_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./app/api/chat/route.ts */ \"(rsc)/./app/api/chat/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/chat/route\",\n        pathname: \"/api/chat\",\n        filename: \"route\",\n        bundlePath: \"app/api/chat/route\"\n    },\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"/Users/tadmitinteractive/carbotnext/app/api/chat/route.ts\",\n    nextConfigOutput,\n    userland: _Users_tadmitinteractive_carbotnext_app_api_chat_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/chat/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZjaGF0JTJGcm91dGUmcGFnZT0lMkZhcGklMkZjaGF0JTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGY2hhdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnRhZG1pdGludGVyYWN0aXZlJTJGY2FyYm90bmV4dCUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZ0YWRtaXRpbnRlcmFjdGl2ZSUyRmNhcmJvdG5leHQmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QmaXNHbG9iYWxOb3RGb3VuZEVuYWJsZWQ9ISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNkO0FBQ1M7QUFDTztBQUNLO0FBQ21DO0FBQ2pEO0FBQ087QUFDZjtBQUNzQztBQUN6QjtBQUNNO0FBQ0M7QUFDaEI7QUFDb0I7QUFDdEY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHlHQUFtQjtBQUMzQztBQUNBLGNBQWMsa0VBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsYUFBYSxPQUFvQyxJQUFJLENBQUU7QUFDdkQsd0JBQXdCLE1BQXVDO0FBQy9EO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FB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QTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ04sNkJBQTZCLDZGQUFlO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDJGQUFtQjtBQUNyRDtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYyw2RUFBWTtBQUMxQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7O0FBRUEiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgeyBnZXRSZXF1ZXN0TWV0YSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JlcXVlc3QtbWV0YVwiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IG5vcm1hbGl6ZUFwcFBhdGggfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvcm91dGVyL3V0aWxzL2FwcC1wYXRoc1wiO1xuaW1wb3J0IHsgTm9kZU5leHRSZXF1ZXN0LCBOb2RlTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYmFzZS1odHRwL25vZGVcIjtcbmltcG9ydCB7IE5leHRSZXF1ZXN0QWRhcHRlciwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi9zcGVjLWV4dGVuc2lvbi9hZGFwdGVycy9uZXh0LXJlcXVlc3RcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgZ2V0UmV2YWxpZGF0ZVJlYXNvbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2luc3RydW1lbnRhdGlvbi91dGlsc1wiO1xuaW1wb3J0IHsgc2VuZFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvc2VuZC1yZXNwb25zZVwiO1xuaW1wb3J0IHsgZnJvbU5vZGVPdXRnb2luZ0h0dHBIZWFkZXJzLCB0b05vZGVPdXRnb2luZ0h0dHBIZWFkZXJzIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvd2ViL3V0aWxzXCI7XG5pbXBvcnQgeyBnZXRDYWNoZUNvbnRyb2xIZWFkZXIgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvY2FjaGUtY29udHJvbFwiO1xuaW1wb3J0IHsgSU5GSU5JVEVfQ0FDSEUsIE5FWFRfQ0FDSEVfVEFHU19IRUFERVIgfSBmcm9tIFwibmV4dC9kaXN0L2xpYi9jb25zdGFudHNcIjtcbmltcG9ydCB7IE5vRmFsbGJhY2tFcnJvciB9IGZyb20gXCJuZXh0L2Rpc3Qvc2hhcmVkL2xpYi9uby1mYWxsYmFjay1lcnJvci5leHRlcm5hbFwiO1xuaW1wb3J0IHsgQ2FjaGVkUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcmVzcG9uc2UtY2FjaGVcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvdGFkbWl0aW50ZXJhY3RpdmUvY2FyYm90bmV4dC9hcHAvYXBpL2NoYXQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NoYXQvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jaGF0XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9jaGF0L3JvdXRlXCJcbiAgICB9LFxuICAgIGRpc3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9ESVNUX0RJUiB8fCAnJyxcbiAgICByZWxhdGl2ZVByb2plY3REaXI6IHByb2Nlc3MuZW52Ll9fTkVYVF9SRUxBVElWRV9QUk9KRUNUX0RJUiB8fCAnJyxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy90YWRtaXRpbnRlcmFjdGl2ZS9jYXJib3RuZXh0L2FwcC9hcGkvY2hhdC9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICB2YXIgX25leHRDb25maWdfZXhwZXJpbWVudGFsO1xuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL2NoYXQvcm91dGVcIjtcbiAgICAvLyB0dXJib3BhY2sgZG9lc24ndCBub3JtYWxpemUgYC9pbmRleGAgaW4gdGhlIHBhZ2UgbmFtZVxuICAgIC8vIHNvIHdlIG5lZWQgdG8gdG8gcHJvY2VzcyBkeW5hbWljIHJvdXRlcyBwcm9wZXJseVxuICAgIC8vIFRPRE86IGZpeCB0dXJib3BhY2sgcHJvdmlkaW5nIGRpZmZlcmluZyB2YWx1ZSBmcm9tIHdlYnBhY2tcbiAgICBpZiAocHJvY2Vzcy5lbnYuVFVSQk9QQUNLKSB7XG4gICAgICAgIHNyY1BhZ2UgPSBzcmNQYWdlLnJlcGxhY2UoL1xcL2luZGV4JC8sICcnKSB8fCAnLyc7XG4gICAgfSBlbHNlIGlmIChzcmNQYWdlID09PSAnL2luZGV4Jykge1xuICAgICAgICAvLyB3ZSBhbHdheXMgbm9ybWFsaXplIC9pbmRleCBzcGVjaWZpY2FsbHlcbiAgICAgICAgc3JjUGFnZSA9ICcvJztcbiAgICB9XG4gICAgY29uc3QgbXVsdGlab25lRHJhZnRNb2RlID0gcHJvY2Vzcy5lbnYuX19ORVhUX01VTFRJX1pPTkVfRFJBRlRfTU9ERTtcbiAgICBjb25zdCBwcmVwYXJlUmVzdWx0ID0gYXdhaXQgcm91dGVNb2R1bGUucHJlcGFyZShyZXEsIHJlcywge1xuICAgICAgICBzcmNQYWdlLFxuICAgICAgICBtdWx0aVpvbmVEcmFmdE1vZGVcbiAgICB9KTtcbiAgICBpZiAoIXByZXBhcmVSZXN1bHQpIHtcbiAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDA7XG4gICAgICAgIHJlcy5lbmQoJ0JhZCBSZXF1ZXN0Jyk7XG4gICAgICAgIGN0eC53YWl0VW50aWwgPT0gbnVsbCA/IHZvaWQgMCA6IGN0eC53YWl0VW50aWwuY2FsbChjdHgsIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHsgYnVpbGRJZCwgcGFyYW1zLCBuZXh0Q29uZmlnLCBpc0RyYWZ0TW9kZSwgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQsIGlzT25EZW1hbmRSZXZhbGlkYXRlLCByZXZhbGlkYXRlT25seUdlbmVyYXRlZCwgcmVzb2x2ZWRQYXRobmFtZSB9ID0gcHJlcGFyZVJlc3VsdDtcbiAgICBjb25zdCBub3JtYWxpemVkU3JjUGFnZSA9IG5vcm1hbGl6ZUFwcFBhdGgoc3JjUGFnZSk7XG4gICAgbGV0IGlzSXNyID0gQm9vbGVhbihwcmVyZW5kZXJNYW5pZmVzdC5keW5hbWljUm91dGVzW25vcm1hbGl6ZWRTcmNQYWdlXSB8fCBwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXNbcmVzb2x2ZWRQYXRobmFtZV0pO1xuICAgIGlmIChpc0lzciAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY29uc3QgaXNQcmVyZW5kZXJlZCA9IEJvb2xlYW4ocHJlcmVuZGVyTWFuaWZlc3Qucm91dGVzW3Jlc29sdmVkUGF0aG5hbWVdKTtcbiAgICAgICAgY29uc3QgcHJlcmVuZGVySW5mbyA9IHByZXJlbmRlck1hbmlmZXN0LmR5bmFtaWNSb3V0ZXNbbm9ybWFsaXplZFNyY1BhZ2VdO1xuICAgICAgICBpZiAocHJlcmVuZGVySW5mbykge1xuICAgICAgICAgICAgaWYgKHByZXJlbmRlckluZm8uZmFsbGJhY2sgPT09IGZhbHNlICYmICFpc1ByZXJlbmRlcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vRmFsbGJhY2tFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGxldCBjYWNoZUtleSA9IG51bGw7XG4gICAgaWYgKGlzSXNyICYmICFyb3V0ZU1vZHVsZS5pc0RldiAmJiAhaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgY2FjaGVLZXkgPSByZXNvbHZlZFBhdGhuYW1lO1xuICAgICAgICAvLyBlbnN1cmUgL2luZGV4IGFuZCAvIGlzIG5vcm1hbGl6ZWQgdG8gb25lIGtleVxuICAgICAgICBjYWNoZUtleSA9IGNhY2hlS2V5ID09PSAnL2luZGV4JyA/ICcvJyA6IGNhY2hlS2V5O1xuICAgIH1cbiAgICBjb25zdCBzdXBwb3J0c0R5bmFtaWNSZXNwb25zZSA9IC8vIElmIHdlJ3JlIGluIGRldmVsb3BtZW50LCB3ZSBhbHdheXMgc3VwcG9ydCBkeW5hbWljIEhUTUxcbiAgICByb3V0ZU1vZHVsZS5pc0RldiA9PT0gdHJ1ZSB8fCAvLyBJZiB0aGlzIGlzIG5vdCBTU0cgb3IgZG9lcyBub3QgaGF2ZSBzdGF0aWMgcGF0aHMsIHRoZW4gaXQgc3VwcG9ydHNcbiAgICAvLyBkeW5hbWljIEhUTUwuXG4gICAgIWlzSXNyO1xuICAgIC8vIFRoaXMgaXMgYSByZXZhbGlkYXRpb24gcmVxdWVzdCBpZiB0aGUgcmVxdWVzdCBpcyBmb3IgYSBzdGF0aWNcbiAgICAvLyBwYWdlIGFuZCBpdCBpcyBub3QgYmVpbmcgcmVzdW1lZCBmcm9tIGEgcG9zdHBvbmVkIHJlbmRlciBhbmRcbiAgICAvLyBpdCBpcyBub3QgYSBkeW5hbWljIFJTQyByZXF1ZXN0IHRoZW4gaXQgaXMgYSByZXZhbGlkYXRpb25cbiAgICAvLyByZXF1ZXN0LlxuICAgIGNvbnN0IGlzUmV2YWxpZGF0ZSA9IGlzSXNyICYmICFzdXBwb3J0c0R5bmFtaWNSZXNwb25zZTtcbiAgICBjb25zdCBtZXRob2QgPSByZXEubWV0aG9kIHx8ICdHRVQnO1xuICAgIGNvbnN0IHRyYWNlciA9IGdldFRyYWNlcigpO1xuICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgY29uc3QgY29udGV4dCA9IHtcbiAgICAgICAgcGFyYW1zLFxuICAgICAgICBwcmVyZW5kZXJNYW5pZmVzdCxcbiAgICAgICAgcmVuZGVyT3B0czoge1xuICAgICAgICAgICAgZXhwZXJpbWVudGFsOiB7XG4gICAgICAgICAgICAgICAgY2FjaGVDb21wb25lbnRzOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmNhY2hlQ29tcG9uZW50cyksXG4gICAgICAgICAgICAgICAgYXV0aEludGVycnVwdHM6IEJvb2xlYW4obmV4dENvbmZpZy5leHBlcmltZW50YWwuYXV0aEludGVycnVwdHMpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UsXG4gICAgICAgICAgICBpbmNyZW1lbnRhbENhY2hlOiBnZXRSZXF1ZXN0TWV0YShyZXEsICdpbmNyZW1lbnRhbENhY2hlJyksXG4gICAgICAgICAgICBjYWNoZUxpZmVQcm9maWxlczogKF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbCA9IG5leHRDb25maWcuZXhwZXJpbWVudGFsKSA9PSBudWxsID8gdm9pZCAwIDogX25leHRDb25maWdfZXhwZXJpbWVudGFsLmNhY2hlTGlmZSxcbiAgICAgICAgICAgIGlzUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbCxcbiAgICAgICAgICAgIG9uQ2xvc2U6IChjYik9PntcbiAgICAgICAgICAgICAgICByZXMub24oJ2Nsb3NlJywgY2IpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQWZ0ZXJUYXNrRXJyb3I6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIG9uSW5zdHJ1bWVudGF0aW9uUmVxdWVzdEVycm9yOiAoZXJyb3IsIF9yZXF1ZXN0LCBlcnJvckNvbnRleHQpPT5yb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVycm9yLCBlcnJvckNvbnRleHQsIHJvdXRlclNlcnZlckNvbnRleHQpXG4gICAgICAgIH0sXG4gICAgICAgIHNoYXJlZENvbnRleHQ6IHtcbiAgICAgICAgICAgIGJ1aWxkSWRcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgbm9kZU5leHRSZXEgPSBuZXcgTm9kZU5leHRSZXF1ZXN0KHJlcSk7XG4gICAgY29uc3Qgbm9kZU5leHRSZXMgPSBuZXcgTm9kZU5leHRSZXNwb25zZShyZXMpO1xuICAgIGNvbnN0IG5leHRSZXEgPSBOZXh0UmVxdWVzdEFkYXB0ZXIuZnJvbU5vZGVOZXh0UmVxdWVzdChub2RlTmV4dFJlcSwgc2lnbmFsRnJvbU5vZGVSZXNwb25zZShyZXMpKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnZva2VSb3V0ZU1vZHVsZSA9IGFzeW5jIChzcGFuKT0+e1xuICAgICAgICAgICAgcmV0dXJuIHJvdXRlTW9kdWxlLmhhbmRsZShuZXh0UmVxLCBjb250ZXh0KS5maW5hbGx5KCgpPT57XG4gICAgICAgICAgICAgICAgaWYgKCFzcGFuKSByZXR1cm47XG4gICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICAgICAgJ2h0dHAuc3RhdHVzX2NvZGUnOiByZXMuc3RhdHVzQ29kZSxcbiAgICAgICAgICAgICAgICAgICAgJ25leHQucnNjJzogZmFsc2VcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb25zdCByb290U3BhbkF0dHJpYnV0ZXMgPSB0cmFjZXIuZ2V0Um9vdFNwYW5BdHRyaWJ1dGVzKCk7XG4gICAgICAgICAgICAgICAgLy8gV2Ugd2VyZSB1bmFibGUgdG8gZ2V0IGF0dHJpYnV0ZXMsIHByb2JhYmx5IE9URUwgaXMgbm90IGVuYWJsZWRcbiAgICAgICAgICAgICAgICBpZiAoIXJvb3RTcGFuQXR0cmlidXRlcykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpICE9PSBCYXNlU2VydmVyU3Bhbi5oYW5kbGVSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgVW5leHBlY3RlZCByb290IHNwYW4gdHlwZSAnJHtyb290U3BhbkF0dHJpYnV0ZXMuZ2V0KCduZXh0LnNwYW5fdHlwZScpfScuIFBsZWFzZSByZXBvcnQgdGhpcyBOZXh0LmpzIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS92ZXJjZWwvbmV4dC5qc2ApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gcm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5yb3V0ZScpO1xuICAgICAgICAgICAgICAgIGlmIChyb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYCR7bWV0aG9kfSAke3JvdXRlfWA7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5yb3V0ZSc6IHJvdXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICduZXh0LnNwYW5fbmFtZSc6IG5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNwYW4udXBkYXRlTmFtZShuYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUoYCR7bWV0aG9kfSAke3JlcS51cmx9YCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZVJlc3BvbnNlID0gYXN5bmMgKGN1cnJlbnRTcGFuKT0+e1xuICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlO1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VHZW5lcmF0b3IgPSBhc3luYyAoeyBwcmV2aW91c0NhY2hlRW50cnkgfSk9PntcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykgJiYgaXNPbkRlbWFuZFJldmFsaWRhdGUgJiYgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQgJiYgIXByZXZpb3VzQ2FjaGVFbnRyeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnN0YXR1c0NvZGUgPSA0MDQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbi1kZW1hbmQgcmV2YWxpZGF0ZSBhbHdheXMgc2V0cyB0aGlzIGhlYWRlclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCAnUkVWQUxJREFURUQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5lbmQoJ1RoaXMgcGFnZSBjb3VsZCBub3QgYmUgZm91bmQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoY3VycmVudFNwYW4pO1xuICAgICAgICAgICAgICAgICAgICByZXEuZmV0Y2hNZXRyaWNzID0gY29udGV4dC5yZW5kZXJPcHRzLmZldGNoTWV0cmljcztcbiAgICAgICAgICAgICAgICAgICAgbGV0IHBlbmRpbmdXYWl0VW50aWwgPSBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbDtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXR0ZW1wdCB1c2luZyBwcm92aWRlZCB3YWl0VW50aWwgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIGl0J3Mgbm90IHdlIGZhbGxiYWNrIHRvIHNlbmRSZXNwb25zZSdzIGhhbmRsaW5nXG4gICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nV2FpdFVudGlsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3R4LndhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC53YWl0VW50aWwocGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1dhaXRVbnRpbCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZVRhZ3MgPSBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkVGFncztcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljIHJlc3BvbnNlLCB3ZSBjYW4gY2FjaGUgaXQgc28gbG9uZ1xuICAgICAgICAgICAgICAgICAgICAvLyBhcyBpdCdzIG5vdCBlZGdlLlxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNJc3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDb3B5IHRoZSBoZWFkZXJzIGZyb20gdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IHRvTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMocmVzcG9uc2UuaGVhZGVycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2FjaGVUYWdzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1tORVhUX0NBQ0hFX1RBR1NfSEVBREVSXSA9IGNhY2hlVGFncztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGVhZGVyc1snY29udGVudC10eXBlJ10gJiYgYmxvYi50eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1snY29udGVudC10eXBlJ10gPSBibG9iLnR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXZhbGlkYXRlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlID09PSAndW5kZWZpbmVkJyB8fCBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA+PSBJTkZJTklURV9DQUNIRSA/IGZhbHNlIDogY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBpcmUgPSB0eXBlb2YgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZEV4cGlyZSA+PSBJTkZJTklURV9DQUNIRSA/IHVuZGVmaW5lZCA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdGhlIGNhY2hlIGVudHJ5IGZvciB0aGUgcmVzcG9uc2UuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjYWNoZUVudHJ5ID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtpbmQ6IENhY2hlZFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBCdWZmZXIuZnJvbShhd2FpdCBibG9iLmFycmF5QnVmZmVyKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWNoZUNvbnRyb2w6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZUVudHJ5O1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCByZXNwb25zZSB3aXRob3V0IGNhY2hpbmcgaWYgbm90IElTUlxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgcmVzcG9uc2UsIGNvbnRleHQucmVuZGVyT3B0cy5wZW5kaW5nV2FpdFVudGlsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBiYWNrZ3JvdW5kIHJldmFsaWRhdGUgd2UgbmVlZCB0byByZXBvcnRcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJlcXVlc3QgZXJyb3IgaGVyZSBhcyBpdCB3b24ndCBiZSBidWJibGVkXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c0NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IHByZXZpb3VzQ2FjaGVFbnRyeS5pc1N0YWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IHNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHJvdXRlclNlcnZlckNvbnRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IGF3YWl0IHJvdXRlTW9kdWxlLmhhbmRsZVJlc3BvbnNlKHtcbiAgICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgICAgbmV4dENvbmZpZyxcbiAgICAgICAgICAgICAgICBjYWNoZUtleSxcbiAgICAgICAgICAgICAgICByb3V0ZUtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgICAgICAgICAgaXNGYWxsYmFjazogZmFsc2UsXG4gICAgICAgICAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgICAgICAgICAgaXNSb3V0ZVBQUkVuYWJsZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlR2VuZXJhdG9yLFxuICAgICAgICAgICAgICAgIHdhaXRVbnRpbDogY3R4LndhaXRVbnRpbFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyB3ZSBkb24ndCBjcmVhdGUgYSBjYWNoZUVudHJ5IGZvciBJU1JcbiAgICAgICAgICAgIGlmICghaXNJc3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgoY2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlID0gY2FjaGVFbnRyeS52YWx1ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9jYWNoZUVudHJ5X3ZhbHVlLmtpbmQpICE9PSBDYWNoZWRSb3V0ZUtpbmQuQVBQX1JPVVRFKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9jYWNoZUVudHJ5X3ZhbHVlMTtcbiAgICAgICAgICAgICAgICB0aHJvdyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3IEVycm9yKGBJbnZhcmlhbnQ6IGFwcC1yb3V0ZSByZWNlaXZlZCBpbnZhbGlkIGNhY2hlIGVudHJ5ICR7Y2FjaGVFbnRyeSA9PSBudWxsID8gdm9pZCAwIDogKF9jYWNoZUVudHJ5X3ZhbHVlMSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZTEua2luZH1gKSwgXCJfX05FWFRfRVJST1JfQ09ERVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBcIkU3MDFcIixcbiAgICAgICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpKSB7XG4gICAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcigneC1uZXh0anMtY2FjaGUnLCBpc09uRGVtYW5kUmV2YWxpZGF0ZSA/ICdSRVZBTElEQVRFRCcgOiBjYWNoZUVudHJ5LmlzTWlzcyA/ICdNSVNTJyA6IGNhY2hlRW50cnkuaXNTdGFsZSA/ICdTVEFMRScgOiAnSElUJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEcmFmdCBtb2RlIHNob3VsZCBuZXZlciBiZSBjYWNoZWRcbiAgICAgICAgICAgIGlmIChpc0RyYWZ0TW9kZSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnLCAncHJpdmF0ZSwgbm8tY2FjaGUsIG5vLXN0b3JlLCBtYXgtYWdlPTAsIG11c3QtcmV2YWxpZGF0ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyhjYWNoZUVudHJ5LnZhbHVlLmhlYWRlcnMpO1xuICAgICAgICAgICAgaWYgKCEoZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSAmJiBpc0lzcikpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLmRlbGV0ZShORVhUX0NBQ0hFX1RBR1NfSEVBREVSKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIGNhY2hlIGNvbnRyb2wgaXMgYWxyZWFkeSBzZXQgb24gdGhlIHJlc3BvbnNlIHdlIGRvbid0XG4gICAgICAgICAgICAvLyBvdmVycmlkZSBpdCB0byBhbGxvdyB1c2VycyB0byBjdXN0b21pemUgaXQgdmlhIG5leHQuY29uZmlnXG4gICAgICAgICAgICBpZiAoY2FjaGVFbnRyeS5jYWNoZUNvbnRyb2wgJiYgIXJlcy5nZXRIZWFkZXIoJ0NhY2hlLUNvbnRyb2wnKSAmJiAhaGVhZGVycy5nZXQoJ0NhY2hlLUNvbnRyb2wnKSkge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCdDYWNoZS1Db250cm9sJywgZ2V0Q2FjaGVDb250cm9sSGVhZGVyKGNhY2hlRW50cnkuY2FjaGVDb250cm9sKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UoY2FjaGVFbnRyeS52YWx1ZS5ib2R5LCB7XG4gICAgICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGNhY2hlRW50cnkudmFsdWUuc3RhdHVzIHx8IDIwMFxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG4gICAgICAgIC8vIFRPRE86IGFjdGl2ZVNwYW4gY29kZSBwYXRoIGlzIGZvciB3aGVuIHdyYXBwZWQgYnlcbiAgICAgICAgLy8gbmV4dC1zZXJ2ZXIgY2FuIGJlIHJlbW92ZWQgd2hlbiB0aGlzIGlzIG5vIGxvbmdlciB1c2VkXG4gICAgICAgIGlmIChhY3RpdmVTcGFuKSB7XG4gICAgICAgICAgICBhd2FpdCBoYW5kbGVSZXNwb25zZShhY3RpdmVTcGFuKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGF3YWl0IHRyYWNlci53aXRoUHJvcGFnYXRlZENvbnRleHQocmVxLmhlYWRlcnMsICgpPT50cmFjZXIudHJhY2UoQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCwge1xuICAgICAgICAgICAgICAgICAgICBzcGFuTmFtZTogYCR7bWV0aG9kfSAke3JlcS51cmx9YCxcbiAgICAgICAgICAgICAgICAgICAga2luZDogU3BhbktpbmQuU0VSVkVSLFxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC5tZXRob2QnOiBtZXRob2QsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaHR0cC50YXJnZXQnOiByZXEudXJsXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBoYW5kbGVSZXNwb25zZSkpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGlmICghKGVyciBpbnN0YW5jZW9mIE5vRmFsbGJhY2tFcnJvcikpIHtcbiAgICAgICAgICAgIGF3YWl0IHJvdXRlTW9kdWxlLm9uUmVxdWVzdEVycm9yKHJlcSwgZXJyLCB7XG4gICAgICAgICAgICAgICAgcm91dGVyS2luZDogJ0FwcCBSb3V0ZXInLFxuICAgICAgICAgICAgICAgIHJvdXRlUGF0aDogbm9ybWFsaXplZFNyY1BhZ2UsXG4gICAgICAgICAgICAgICAgcm91dGVUeXBlOiAncm91dGUnLFxuICAgICAgICAgICAgICAgIHJldmFsaWRhdGVSZWFzb246IGdldFJldmFsaWRhdGVSZWFzb24oe1xuICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgIGlzT25EZW1hbmRSZXZhbGlkYXRlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJldGhyb3cgc28gdGhhdCB3ZSBjYW4gaGFuZGxlIHNlcnZpbmcgZXJyb3IgcGFnZVxuICAgICAgICAvLyBJZiB0aGlzIGlzIGR1cmluZyBzdGF0aWMgZ2VuZXJhdGlvbiwgdGhyb3cgdGhlIGVycm9yIGFnYWluLlxuICAgICAgICBpZiAoaXNJc3IpIHRocm93IGVycjtcbiAgICAgICAgLy8gT3RoZXJ3aXNlLCBzZW5kIGEgNTAwIHJlc3BvbnNlLlxuICAgICAgICBhd2FpdCBzZW5kUmVzcG9uc2Uobm9kZU5leHRSZXEsIG5vZGVOZXh0UmVzLCBuZXcgUmVzcG9uc2UobnVsbCwge1xuICAgICAgICAgICAgc3RhdHVzOiA1MDBcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXBcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("@prisma/client");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/bcryptjs","vendor-chunks/oauth","vendor-chunks/object-hash","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/lru-cache","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva","vendor-chunks/zod"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fchat%2Froute&page=%2Fapi%2Fchat%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fchat%2Froute.ts&appDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Ftadmitinteractive%2Fcarbotnext&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();